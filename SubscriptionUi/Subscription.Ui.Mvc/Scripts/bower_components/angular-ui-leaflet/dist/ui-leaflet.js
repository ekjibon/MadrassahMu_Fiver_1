!function(z){"use strict";z.module("ui-leaflet",["nemLogging"]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletMapEvents",function(t,d,p,g,y){return{restrict:"EA",replace:!0,scope:{center:"=",lfCenter:"=",defaults:"=",maxbounds:"=",bounds:"=",markers:"=",legend:"=",geojson:"=",paths:"=",tiles:"=",layers:"=",controls:"=",decorations:"=",eventBroadcast:"=",watchOptions:"=",id:"@"},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function(e){this._leafletMap=t.defer(),this.getMap=function(){return this._leafletMap.promise},this.getLeafletScope=function(){return e}}],link:function(e,t,r,n){var a=g.isDefined,o=p.setDefaults(e.defaults,r.id),i=y.getAvailableMapEvents(),l=y.addEvents;function s(){isNaN(r.width)?t.css("width",r.width):t.css("width",r.width+"px")}function c(){isNaN(r.height)?t.css("height",r.height):t.css("height",r.height+"px")}e.mapId=r.id,d.setDirectiveControls({},r.id);var u=new L.Map(t[0],p.getMapCreationDefaults(r.id));if(n._leafletMap.resolve(u),a(r.width)&&(s(),e.$watch(function(){return t[0].getAttribute("width")},function(){s(),u.invalidateSize()})),a(r.height)&&(c(),e.$watch(function(){return t[0].getAttribute("height")},function(){c(),u.invalidateSize()})),a(r.center)||a(r.lfCenter)||u.setView([o.center.lat,o.center.lng],o.center.zoom),!a(r.tiles)&&!a(r.layers)){var f=L.tileLayer(o.tileLayer,o.tileLayerOptions);f.addTo(u),d.setTiles(f,r.id)}if(a(u.zoomControl)&&a(o.zoomControlPosition)&&u.zoomControl.setPosition(o.zoomControlPosition),a(u.zoomControl)&&!1===o.zoomControl&&u.zoomControl.removeFrom(u),a(u.zoomsliderControl)&&a(o.zoomsliderControl)&&!1===o.zoomsliderControl&&u.zoomsliderControl.removeFrom(u),!a(r.eventBroadcast)){l(u,r.id,i,"eventName",e,"broadcast")}u.whenReady(function(){d.setMap(u,r.id)}),e.$on("$destroy",function(){p.reset(),u.remove(),d.unresolveMap(r.id)}),e.$on("invalidateSize",function(){u.invalidateSize()})}}}]),z.module("ui-leaflet").factory("eventManager",[function(){function e(){this.listeners={}}return e.prototype={addEventListener:function(e,t,r){for(var n=[],a=arguments.length,o=0;o<a;o++)n.push(arguments[o]);n=3<n.length?n.splice(3,n.length-1):[],void 0!==this.listeners[e]?this.listeners[e].push({scope:r,callback:t,args:n}):this.listeners[e]=[{scope:r,callback:t,args:n}]},removeEventListener:function(e,t,r){if(void 0!==this.listeners[e]){for(var n=this.listeners[e].length,a=[],o=0;o<n;o++){var i=this.listeners[e][o];i.scope===r&&i.callback===t||a.push(i)}this.listeners[e]=a}},hasEventListener:function(e,t,r){if(void 0!==this.listeners[e]){var n=this.listeners[e].length;if(void 0===t&&void 0===r)return 0<n;for(var a=0;a<n;a++){var o=this.listeners[e][a];if((!r||o.scope===r)&&o.callback===t)return!0}}return!1},dispatch:function(e,t){for(var r={type:e,target:t},n=[],a=arguments.length,o=0;o<a;o++)n.push(arguments[o]);if(n=2<n.length?n.splice(2,n.length-1):[],n=[r].concat(n),void 0!==this.listeners[e])for(var i=this.listeners[e].length,l=0;l<i;l++){var s=this.listeners[e][l];if(s&&s.callback){var c=n.concat(s.args);s.callback.apply(s.scope,c),0}}},getEvents:function(){var e="";for(var t in this.listeners)for(var r=this.listeners[t].length,n=0;n<r;n++){var a=this.listeners[t][n];e+=a.scope&&a.scope.className?a.scope.className:"anonymous",e+=" listen for '"+t+"'\n"}return e}},e}]).service("eventManager",["EventManager",function(e){return new e}]),z.module("ui-leaflet").factory("leafletBoundsHelpers",["leafletLogger","leafletHelpers",function(e,t){var r=t.isArray,n=t.isNumber,a=t.isFunction,o=t.isDefined,i=e;function l(e){return z.isDefined(e)&&z.isDefined(e.southWest)&&z.isDefined(e.northEast)&&z.isNumber(e.southWest.lat)&&z.isNumber(e.southWest.lng)&&z.isNumber(e.northEast.lat)&&z.isNumber(e.northEast.lng)}return{createLeafletBounds:function(e){if(l(e))return L.latLngBounds([e.southWest.lat,e.southWest.lng],[e.northEast.lat,e.northEast.lng])},isValidBounds:l,createBoundsFromArray:function(e){if(r(e)&&2===e.length&&r(e[0])&&r(e[1])&&2===e[0].length&&2===e[1].length&&n(e[0][0])&&n(e[0][1])&&n(e[1][0])&&n(e[1][1]))return{northEast:{lat:e[0][0],lng:e[0][1]},southWest:{lat:e[1][0],lng:e[1][1]}};i.error("[AngularJS - Leaflet] The bounds array is not valid.")},createBoundsFromLeaflet:function(e){if(o(e)&&a(e.getNorthEast)&&a(e.getSouthWest)){var t=e.getNorthEast(),r=e.getSouthWest();return{northEast:{lat:t.lat,lng:t.lng},southWest:{lat:r.lat,lng:r.lng}}}i.error("[AngularJS - Leaflet] The leaflet bounds is not valid object.")}}}]),z.module("ui-leaflet").factory("leafletControlHelpers",["$rootScope","leafletLogger","leafletHelpers","leafletLayerHelpers","leafletMapDefaults",function(e,t,r,n,c){function u(r,n,e){var t=c.getDefaults(e);if(!d(t,"controls.layers.visible"))return!1;var a=!1;return o(r)&&Object.keys(r).forEach(function(e){var t=r[e];f(t.layerOptions)&&!1===t.layerOptions.showOnSelector||(a=!0)}),o(n)&&Object.keys(n).forEach(function(e){var t=n[e];f(t.layerParams)&&!1===t.layerParams.showOnSelector||(a=!0)}),a}var f=r.isDefined,o=r.isObject,d=r.get,a=n.createLayer,p={},i=r.errorHeader+" [Controls] ",l=t,s={draw:{isPluginLoaded:function(){return!!z.isDefined(L.Control.Draw)||(l.error(i+" Draw plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(e){return new L.Control.Draw(e)}},scale:{isPluginLoaded:function(){return!0},checkValidParams:function(){return!0},createControl:function(e){return new L.control.scale(e)}},fullscreen:{isPluginLoaded:function(){return!!z.isDefined(L.Control.Fullscreen)||(l.error(i+" Fullscreen plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(e){return new L.Control.Fullscreen(e)}},search:{isPluginLoaded:function(){return!!z.isDefined(L.Control.Search)||(l.error(i+" Search plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(e){return new L.Control.Search(e)}},custom:{},minimap:{isPluginLoaded:function(){return!!z.isDefined(L.Control.MiniMap)||(l.error(i+" Minimap plugin is not loaded."),!1)},checkValidParams:function(e){return!!f(e.layer)||(l.warn(i+' minimap "layer" option should be defined.'),!1)},createControl:function(e){var t=a(e.layer);if(f(t))return new L.Control.MiniMap(t,e);l.warn(i+' minimap control "layer" could not be created.')}}};return{layersControlMustBeVisible:u,isValidControlType:function(e){return-1!==Object.keys(s).indexOf(e)},createControl:function(e,t){if(s[e].checkValidParams(t))return s[e].createControl(t)},updateLayersControl:function(e,t,r,n,a,o){var i,l=p[t],s=u(n,a,t);if(f(l)&&r){for(i in o.baselayers)l.removeLayer(o.baselayers[i]);for(i in o.overlays)l.removeLayer(o.overlays[i]);e.removeControl(l),delete p[t]}if(s){for(i in l=function(e){var t=c.getDefaults(e),r={collapsed:t.controls.layers.collapsed,position:t.controls.layers.position,autoZIndex:!1};return z.extend(r,t.controls.layers.options),d(t,"controls.layers.control")?t.controls.layers.control.apply(this,[[],[],r]):new L.control.layers([],[],r)}(t),p[t]=l,n){!(f(n[i].layerOptions)&&!1===n[i].layerOptions.showOnSelector)&&f(o.baselayers[i])&&l.addBaseLayer(o.baselayers[i],n[i].name)}for(i in a){!(f(a[i].layerParams)&&!1===a[i].layerParams.showOnSelector)&&f(o.overlays[i])&&l.addOverlay(o.overlays[i],a[i].name)}e.addControl(l)}return s},destroyMapLayersControl:function(e){delete p[e]}}}]),z.module("ui-leaflet").service("leafletData",["leafletLogger","$q","leafletHelpers",function(e,t,r){var n=r.getDefer,a=r.getUnresolvedDefer,o=r.setResolvedDefer,i={},l=this,s=["map","tiles","layers","paths","markers","geoJSON","UTFGrid","decorations","directiveControls"];s.forEach(function(e){i[e]={}}),this.unresolveMap=function(e){var t=r.obtainEffectiveMapId(i.map,e);s.forEach(function(e){i[e][t]=void 0})},s.forEach(function(r){var e,t=(e=r).charAt(0).toUpperCase()+e.slice(1);l["set"+t]=function(e,t){a(i[r],t).resolve(e),o(i[r],t)},l["get"+t]=function(e){return n(i[r],e).promise}})}]),z.module("ui-leaflet").service("leafletDirectiveControlsHelpers",["leafletLogger","leafletData","leafletHelpers",function(e,i,t){var l=t.isDefined,s=t.isString,c=t.isObject,r=t.errorHeader,u=e,f=r+"[leafletDirectiveControlsHelpers";return{extend:function(t,e,r,n){var a=f+".extend] ",o={};if(l(e)){if(s(e)&&l(r)&&l(n))o[e]={create:r,clean:n};else{if(!c(e)||l(r)||l(n))return void u.error(a+"incorrect arguments");o=e}i.getDirectiveControls(t).then(function(e){z.extend(e,o),i.setDirectiveControls(e,t)})}else u.error(a+"thingToAddName cannot be undefined")}}}]),z.module("ui-leaflet").service("leafletGeoJsonHelpers",["leafletHelpers","leafletIterators",function(e,t){function r(e,t){return this.lat=e,this.lng=t,this}function n(t){if(a.isUndefined(t))return!1;if(a.isArray(t)){if(2===t.length&&a.isNumber(t[0])&&a.isNumber(t[1]))return!0}else if(a.isDefined(t.type)&&"Point"===t.type&&a.isArray(t.coordinates)&&2===t.coordinates.length&&a.isNumber(t.coordinates[0])&&a.isNumber(t.coordinates[1]))return!0;return o.all(["lat","lng"],function(e){return a.isDefined(t[e])&&a.isNumber(t[e])})}var a=e,o=t;return{getLat:function(e){return Array.isArray(e)&&2===e.length?e[1]:a.isDefined(e.type)&&"Point"===e.type?+e.coordinates[1]:+e.lat},getLng:function(e){return Array.isArray(e)&&2===e.length?e[0]:a.isDefined(e.type)&&"Point"===e.type?+e.coordinates[0]:+e.lng},validateCoords:n,getCoords:function(e){if(e&&n(e)){var t=null;if(Array.isArray(e)&&2===e.length)t=new r(e[1],e[0]);else{if(!a.isDefined(e.type)||"Point"!==e.type)return e;t=new r(e.coordinates[1],e.coordinates[0])}return z.extend(e,t)}}}}]),z.module("ui-leaflet").service("leafletHelpers",["$q","$log","$timeout",function(a,e,o){function t(e,t){if(e){for(var r=e[(t=t.split(".")).shift()];r&&t.length;)r=r[t.shift()];return r}}var i="[ui-leaflet] ",r=z.copy;function l(e,t){var r,n=Object.keys(e);if(z.isDefined(t))r=t;else{if(0!==n.length&&(1!==n.length||"main"!==n[0]))throw new Error(i+"- You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call. Where one of the following mapIds "+Object.keys(e).join(",")+" are available.");r="main"}return r}function n(e,t){var r,n=l(e,t);return z.isDefined(e[n])&&!0!==e[n].resolvedDefer?r=e[n].defer:(r=a.defer(),e[n]={defer:r,resolvedDefer:!1}),r}function s(e){return z.isDefined(e)&&null!==e}function c(e){return e.replace(u,function(e,t,r,n){return n?r.toUpperCase():r}).replace(f,"Moz$1")}var u=/([\:\-\_]+(.))/g,f=/^moz([A-Z])/,d=/^((?:x|data)[\:\-_])/i;return{watchTrapDelayMilliSec:10,modelChangeInDirective:function(e,t,r){if(!e)throw new Error(i+"trapObj is undefined");if(!t)throw new Error(i+"trapField is undefined");e[t]=!0;var n=r();return o(function(){e[t]=!1},10),n},camelCase:c,directiveNormalize:function(e){return c(e.replace(d,""))},copy:r,clone:r,errorHeader:i,getObjectValue:t,get:t,getObjectArrayPath:function(e){return e.split(".").reduce(function(e,t){return e+'["'+t+'"]'})},getObjectDotPath:function(e){return e.reduce(function(e,t){return e+"."+t})},defaultTo:function(e,t){return s(e)?e:t},isTruthy:function(e){return"true"===e||!0===e},isEmpty:function(e){return 0===Object.keys(e).length},isUndefinedOrEmpty:function(e){return z.isUndefined(e)||null===e||0===Object.keys(e).length},isDefined:s,isUndefined:function(e){return!s(e)},isNumber:z.isNumber,isString:z.isString,isArray:z.isArray,isObject:z.isObject,isFunction:z.isFunction,equals:z.equals,isValidCenter:function(e){return z.isDefined(e)&&z.isNumber(e.lat)&&z.isNumber(e.lng)&&z.isNumber(e.zoom)},isValidPoint:function(e){return!!z.isDefined(e)&&(z.isArray(e)?2===e.length&&z.isNumber(e[0])&&z.isNumber(e[1]):z.isNumber(e.lat)&&z.isNumber(e.lng))},isSameCenterOnMap:function(e,t){var r=t.getCenter(),n=t.getZoom();return!(!e.lat||!e.lng||r.lat.toFixed(4)!==e.lat.toFixed(4)||r.lng.toFixed(4)!==e.lng.toFixed(4)||n!==e.zoom)},safeApply:function(e,t){var r=e.$root.$$phase;"$apply"===r||"$digest"===r?e.$eval(t):e.$evalAsync(t)},obtainEffectiveMapId:l,getDefer:function(e,t){var r=l(e,t);return z.isDefined(e[r])&&!1!==e[r].resolvedDefer?e[r].defer:n(e,t)},getUnresolvedDefer:n,setResolvedDefer:function(e,t){e[l(e,t)].resolvedDefer=!0},rangeIsSupported:function(){var e=document.createElement("input");return e.setAttribute("type","range"),"range"===e.type},FullScreenControlPlugin:{isLoaded:function(){return z.isDefined(L.Control.Fullscreen)}},MiniMapControlPlugin:{isLoaded:function(){return z.isDefined(L.Control.MiniMap)}},AwesomeMarkersPlugin:{isLoaded:function(){return z.isDefined(L.AwesomeMarkers)&&z.isDefined(L.AwesomeMarkers.Icon)},is:function(e){return!!this.isLoaded()&&e instanceof L.AwesomeMarkers.Icon},equal:function(e,t){return!!this.isLoaded()&&(!!this.is(e)&&z.equals(e,t))}},VectorMarkersPlugin:{isLoaded:function(){return z.isDefined(L.VectorMarkers)&&z.isDefined(L.VectorMarkers.Icon)},is:function(e){return!!this.isLoaded()&&e instanceof L.VectorMarkers.Icon},equal:function(e,t){return!!this.isLoaded()&&(!!this.is(e)&&z.equals(e,t))}},DomMarkersPlugin:{isLoaded:function(){return!(!z.isDefined(L.DomMarkers)||!z.isDefined(L.DomMarkers.Icon))},is:function(e){return!!this.isLoaded()&&e instanceof L.DomMarkers.Icon},equal:function(e,t){return!!this.isLoaded()&&(!!this.is(e)&&z.equals(e,t))}},PolylineDecoratorPlugin:{isLoaded:function(){return!!z.isDefined(L.PolylineDecorator)},is:function(e){return!!this.isLoaded()&&e instanceof L.PolylineDecorator},equal:function(e,t){return!!this.isLoaded()&&(!!this.is(e)&&z.equals(e,t))}},MakiMarkersPlugin:{isLoaded:function(){return!(!z.isDefined(L.MakiMarkers)||!z.isDefined(L.MakiMarkers.Icon))},is:function(e){return!!this.isLoaded()&&e instanceof L.MakiMarkers.Icon},equal:function(e,t){return!!this.isLoaded()&&(!!this.is(e)&&z.equals(e,t))}},ExtraMarkersPlugin:{isLoaded:function(){return!(!z.isDefined(L.ExtraMarkers)||!z.isDefined(L.ExtraMarkers.Icon))},is:function(e){return!!this.isLoaded()&&e instanceof L.ExtraMarkers.Icon},equal:function(e,t){return!!this.isLoaded()&&(!!this.is(e)&&z.equals(e,t))}},LabelPlugin:{isLoaded:function(){return z.isDefined(L.Label)},is:function(e){return!!this.isLoaded()&&e instanceof L.MarkerClusterGroup}},MarkerClusterPlugin:{isLoaded:function(){return z.isDefined(L.MarkerClusterGroup)},is:function(e){return!!this.isLoaded()&&e instanceof L.MarkerClusterGroup}},GeoJSONPlugin:{isLoaded:function(){return z.isDefined(L.TileLayer.GeoJSON)},is:function(e){return!!this.isLoaded()&&e instanceof L.TileLayer.GeoJSON}},CartoDB:{isLoaded:function(){return cartodb},is:function(){return!0}},Leaflet:{DivIcon:{is:function(e){return e instanceof L.DivIcon},equal:function(e,t){return!!this.is(e)&&z.equals(e,t)}},Icon:{is:function(e){return e instanceof L.Icon},equal:function(e,t){return!!this.is(e)&&z.equals(e,t)}}},watchOptions:{type:"watchDeep",individual:{type:"watchDeep"}}}}]),z.module("ui-leaflet").service("leafletIterators",["leafletLogger","leafletHelpers",function(e,t){function a(e){return e}var r,s,c,u=t,o=t.errorHeader+"leafletIterators: ",f=Object.keys,i=u.isFunction,l=u.isObject,d=e,p=Math.pow(2,53)-1;s=f,r=function(e){var t=arguments.length;if(t<2||null===e)return e;for(var r=1;r<t;r++)for(var n=arguments[r],a=s(n),o=a.length,i=0;i<o;i++){var l=a[i];c&&void 0!==e[l]||(e[l]=n[l])}return e};var g;g=function(t){return t=r({},t),function(e){return function(e,t){var r=f(t),n=r.length;if(null===e)return!n;for(var a=Object(e),o=0;o<n;o++){var i=r[o];if(t[i]!==a[i]||!(i in a))return!1}return!0}(e,t)}};function y(e,t,r){return null===e?a:i(e)?function(a,o,e){if(void 0===o)return a;switch(null===e?3:e){case 1:return function(e){return a.call(o,e)};case 2:return function(e,t){return a.call(o,e,t)};case 3:return function(e,t,r){return a.call(o,e,t,r)};case 4:return function(e,t,r,n){return a.call(o,e,t,r,n)}}return function(){return a.apply(o,arguments)}}(e,t,r):l(e)?g(e):(n=e,function(e){return null===e?void 0:e[n]});var n}var n,v;n=v=function(e,t,r){t=y(t,r);for(var n,a,o=(a=null!==(n=e)&&n.length,!(u.isNumber(a)&&0<=a&&a<=p)&&f(e)),i=(o||e).length,l=0;l<i;l++){var s=o?o[l]:l;if(!t(e[s],s,e))return!1}return!0};function m(e,t,r,n){return!(r||u.isDefined(e)&&u.isDefined(t))||!u.isFunction(t)&&(n=u.defaultTo(t,"cb"),d.error(o+n+" is not a function"),!0)}function h(e,r){!function(e,t,r){if(!m(void 0,r,!0,"internalCb")&&!m(e,t))for(var n in e)e.hasOwnProperty(n)&&r(e[n],n)}(e,r,function(e,t){r(e,t)})}return{each:h,forEach:h,every:n,all:v}}]),z.module("ui-leaflet").factory("leafletLayerHelpers",["$rootScope","$q","leafletLogger","leafletHelpers","leafletIterators",function(n,e,t,r,a){function i(e){if(o.UTFGridPlugin.isLoaded()){var t=new L.UtfGrid(e.url,e.pluginOptions),r={model:e.$parent};return t.on("mouseover",function(e){z.extend(r,{leafletEvent:e,leafletObject:e.target}),n.$broadcast("leafletDirectiveMap.utfgridMouseover",r)}),t.on("mouseout",function(e){z.extend(r,{leafletEvent:e,leafletObject:e.target}),n.$broadcast("leafletDirectiveMap.utfgridMouseout",r)}),t.on("click",function(e){z.extend(r,{leafletEvent:e,leafletObject:e.target}),n.$broadcast("leafletDirectiveMap.utfgridClick",r)}),t.on("mousemove",function(e){z.extend(r,{leafletEvent:e,leafletObject:e.target}),n.$broadcast("leafletDirectiveMap.utfgridMousemove",r)}),t}p.error("[AngularJS - Leaflet] The UTFGrid plugin is not loaded.")}var o=r,l=r.isString,s=r.isObject,c=r.isArray,u=r.isDefined,f=r.errorHeader,d=a,p=t,g={xyz:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer(e.url,e.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(e){if(o.GeoJSONPlugin.isLoaded())return new L.TileLayer.GeoJSON(e.url,e.pluginOptions,e.options)}},geoJSONShape:{mustHaveUrl:!1,createLayer:function(e){return new L.GeoJSON(e.data,e.options)}},geoJSONAwesomeMarker:{mustHaveUrl:!1,createLayer:function(r){return new L.geoJson(r.data,{pointToLayer:function(e,t){return L.marker(t,{icon:L.AwesomeMarkers.icon(r.icon)})}})}},geoJSONVectorMarker:{mustHaveUrl:!1,createLayer:function(r){return new L.geoJson(r.data,{pointToLayer:function(e,t){return L.marker(t,{icon:L.VectorMarkers.icon(r.icon)})}})}},cartodbTiles:{mustHaveKey:!0,createLayer:function(e){var t=u(e.url)?e.url+"/"+e.user:"//"+e.user+".cartodb.com";return t+="/api/v1/map/"+e.key+"/{z}/{x}/{y}.png",L.tileLayer(t,e.options)}},cartodbUTFGrid:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(e){var t=u(e.url)?e.url+"/"+e.user:"//"+e.user+".cartodb.com";return e.url=t+"/api/v1/map/"+e.key+"/"+e.layer+"/{z}/{x}/{y}.grid.json",i(e)}},cartodbInteractive:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(e){function t(e,t,r){var n=z.copy(t);n.url=a+"/api/v1/map/"+n.key+"/"+r+"/{z}/{x}/{y}.grid.json",e.push(i(n))}var a=u(e.url)?e.url+"/"+e.user:"//"+e.user+".cartodb.com",r=a+"/api/v1/map/"+e.key+"/{z}/{x}/{y}.png",n=[L.tileLayer(r,e.options)];if(c(e.layer))for(var o=0;o<e.layer.length;o++)t(n,e,e.layer[o]);else t(n,e,e.layer);return L.layerGroup(n)}},wms:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.wms(e.url,e.options)}},wmts:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.wmts(e.url,e.options)}},group:{mustHaveUrl:!1,createLayer:function(n){var t=[];return d.each(n.options.layers,function(e){t.push(y(e))}),n.options.loadedDefer=function(){var e=[];if(u(n.options.layers))for(var t=0;t<n.options.layers.length;t++){var r=n.options.layers[t].layerOptions.loadedDefer;u(r)&&e.push(r)}return e},L.layerGroup(t)}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},markercluster:{mustHaveUrl:!1,createLayer:function(e){if(o.MarkerClusterPlugin.isLoaded())return new L.MarkerClusterGroup(e.options);p.warn(f+" The markercluster plugin is not loaded.")}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(e){return L.imageOverlay(e.url,e.bounds,e.options)}},iip:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.iip(e.url,e.options)}},custom:{createLayer:function(e){if(e.layer instanceof L.Class)return z.copy(e.layer);p.error("[AngularJS - Leaflet] A custom layer must be a leaflet Class")}},cartodb:{mustHaveUrl:!0,createLayer:function(e){return cartodb.createLayer(e.map,e.url)}}};function y(e){if(function(e){if(l(e.type))if(-1!==Object.keys(g).indexOf(e.type))if(!g[e.type].mustHaveUrl||l(e.url))if(!g[e.type].mustHaveData||u(e.data))if(!g[e.type].mustHaveLayer||u(e.layer))if(!g[e.type].mustHaveBounds||u(e.bounds)){if(!g[e.type].mustHaveKey||u(e.key))return 1;p.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have key defined")}else p.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have bounds defined");else p.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have an layer defined");else p.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute');else p.error("[AngularJS - Leaflet] A base layer must have an url");else p.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(g));else p.error("[AngularJS - Leaflet] A layer must have a valid type defined.")}(e)){if(l(e.name)){for(var t in s(e.layerParams)||(e.layerParams={}),s(e.layerOptions)||(e.layerOptions={}),e.layerParams)e.layerOptions[t]=e.layerParams[t];var r={url:e.url,data:e.data,options:e.layerOptions,layer:e.layer,icon:e.icon,type:e.layerType,bounds:e.bounds,key:e.key,apiKey:e.apiKey,pluginOptions:e.pluginOptions,user:e.user,$parent:e};return g[e.type].createLayer(r)}p.error("[AngularJS - Leaflet] A base layer must have a name")}}return{createLayer:y,layerTypes:g,safeAddLayer:function(e,t){t&&"function"==typeof t.addTo?t.addTo(e):e.addLayer(t)},safeRemoveLayer:function(e,t,r){if(u(r)&&u(r.loadedDefer))if(z.isFunction(r.loadedDefer)){var n=r.loadedDefer();p.debug("Loaded Deferred",n);var a=n.length;if(0<a)for(var o=function(){0===--a&&e.removeLayer(t)},i=0;i<n.length;i++)n[i].promise.then(o);else e.removeLayer(t)}else r.loadedDefer.promise.then(function(){e.removeLayer(t)});else e.removeLayer(t)},changeOpacityListener:function(t){return function(e){u(e.setOpacity)&&e.setOpacity(t)}}}}]),z.module("ui-leaflet").factory("leafletLegendHelpers",["$http","$q","$log","leafletHelpers",function(o,n,e,t){function i(e,t,r,n){if(e.innerHTML="",t.error)e.innerHTML+='<div class="info-title alert alert-danger">'+t.error.message+"</div>";else if("arcgis"===r)for(var a=0;a<t.layers.length;a++){var o=t.layers[a];e.innerHTML+='<div class="info-title" data-layerid="'+o.layerId+'">'+o.layerName+"</div>";for(var i=0;i<o.legend.length;i++){var l=o.legend[i];e.innerHTML+='<div class="inline" data-layerid="'+o.layerId+'"><img src="data:'+l.contentType+";base64,"+l.imageData+'" /></div><div class="info-label" data-layerid="'+o.layerId+'">'+l.label+"</div>"}}else"image"===r&&(e.innerHTML='<img src="'+n+'"/>')}var l={},a=t.isDefined;return{getOnAddLegend:function(t,r,n,a){return function(){var e=L.DomUtil.create("div",r);return L.Browser.touch?L.DomEvent.on(e,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"mousewheel",L.DomEvent.stopPropagation)),i(e,t,n,a),e}},getOnAddArrayLegend:function(r,n){return function(){for(var e=L.DomUtil.create("div",n),t=0;t<r.colors.length;t++)e.innerHTML+='<div class="outline"><i style="background:'+r.colors[t]+'"></i></div><div class="info-label">'+r.labels[t]+"</div>";return L.Browser.touch?L.DomEvent.on(e,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"mousewheel",L.DomEvent.stopPropagation)),e}},updateLegend:i,addLegendURL:function(e,t){var r=n.defer();return a(l[e])||(l[e]=[]),l[e].push({c:t,d:r}),1===l[e].length&&function t(r){var n=l[r],a=n[0];o(a.c).then(function(e){n.shift(),a.d.resolve(e),0<n.length&&t(r)},function(e){n.shift(),a.d.reject(e),0<n.length&&t(r)})}(e),r.promise}}}]),z.module("ui-leaflet").factory("leafletMapDefaults",["$q","leafletHelpers",function(e,t){var o=t.isDefined,a=t.isObject,i=t.obtainEffectiveMapId,l={};return{reset:function(){l={}},getDefaults:function(e){var t=i(l,e);return l[t]},getMapCreationDefaults:function(e){var t=i(l,e),r=l[t],n={maxZoom:r.maxZoom,keyboard:r.keyboard,dragging:r.dragging,zoomControl:r.zoomControl,doubleClickZoom:r.doubleClickZoom,scrollWheelZoom:r.scrollWheelZoom,tap:r.tap,touchZoom:r.touchZoom,attributionControl:r.attributionControl,worldCopyJump:r.worldCopyJump,crs:r.crs,trackResize:r.trackResize};if(o(r.minZoom)&&(n.minZoom=r.minZoom),o(r.zoomAnimation)&&(n.zoomAnimation=r.zoomAnimation),o(r.fadeAnimation)&&(n.fadeAnimation=r.fadeAnimation),o(r.markerZoomAnimation)&&(n.markerZoomAnimation=r.markerZoomAnimation),r.map)for(var a in r.map)n[a]=r.map[a];return n},setDefaults:function(e,t){var r={keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,tap:!0,touchZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},nominatim:{server:" http://nominatim.openstreetmap.org/search"},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1},trackResize:!0};o(e)&&(r.doubleClickZoom=o(e.doubleClickZoom)?e.doubleClickZoom:r.doubleClickZoom,r.scrollWheelZoom=o(e.scrollWheelZoom)?e.scrollWheelZoom:r.doubleClickZoom,r.tap=o(e.tap)?e.tap:r.tap,r.touchZoom=o(e.touchZoom)?e.touchZoom:r.doubleClickZoom,r.zoomControl=o(e.zoomControl)?e.zoomControl:r.zoomControl,r.zoomsliderControl=o(e.zoomsliderControl)?e.zoomsliderControl:r.zoomsliderControl,r.attributionControl=o(e.attributionControl)?e.attributionControl:r.attributionControl,r.tileLayer=o(e.tileLayer)?e.tileLayer:r.tileLayer,r.zoomControlPosition=o(e.zoomControlPosition)?e.zoomControlPosition:r.zoomControlPosition,r.keyboard=o(e.keyboard)?e.keyboard:r.keyboard,r.dragging=o(e.dragging)?e.dragging:r.dragging,r.trackResize=o(e.trackResize)?e.trackResize:r.trackResize,o(e.controls)&&z.extend(r.controls,e.controls),a(e.crs)?r.crs=e.crs:o(L.CRS[e.crs])&&(r.crs=L.CRS[e.crs]),o(e.center)&&z.copy(e.center,r.center),o(e.tileLayerOptions)&&z.copy(e.tileLayerOptions,r.tileLayerOptions),o(e.maxZoom)&&(r.maxZoom=e.maxZoom),o(e.minZoom)&&(r.minZoom=e.minZoom),o(e.zoomAnimation)&&(r.zoomAnimation=e.zoomAnimation),o(e.fadeAnimation)&&(r.fadeAnimation=e.fadeAnimation),o(e.markerZoomAnimation)&&(r.markerZoomAnimation=e.markerZoomAnimation),o(e.worldCopyJump)&&(r.worldCopyJump=e.worldCopyJump),o(e.map)&&(r.map=e.map),o(e.path)&&(r.path=e.path));var n=i(l,t);return l[n]=r}}}]),z.module("ui-leaflet").service("leafletMarkersHelpers",["$rootScope","$timeout","leafletHelpers","leafletLogger","$compile","leafletGeoJsonHelpers","leafletWatchHelpers",function(o,s,e,t,i,r,n){function a(t){var r="";return["_icon","_latlng","_leaflet_id","_map","_shadow"].forEach(function(e){r+=e+": "+m(t[e],"undefined")+" \n"}),"[leafletMarker] : \n"+r}function d(e){if(v(e)&&v(e.type)&&"awesomeMarker"===e.type)return b.isLoaded()||T.error(x+" The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(e);if(v(e)&&v(e.type)&&"vectorMarker"===e.type)return k.isLoaded()||T.error(x+" The VectorMarkers Plugin is not loaded."),new L.VectorMarkers.icon(e);if(v(e)&&v(e.type)&&"makiMarker"===e.type)return w.isLoaded()||T.error(x+"The MakiMarkers Plugin is not loaded."),new L.MakiMarkers.icon(e);if(v(e)&&v(e.type)&&"extraMarker"===e.type)return C.isLoaded()||T.error(x+"The ExtraMarkers Plugin is not loaded."),new L.ExtraMarkers.icon(e);if(v(e)&&v(e.type)&&"div"===e.type)return new L.divIcon(e);if(v(e)&&v(e.type)&&"dom"===e.type){A.isLoaded()||T.error(x+"The DomMarkers Plugin is not loaded.");var t=z.isFunction(e.getMarkerScope)?e.getMarkerScope().$new():o,r=i(e.template)(t),n=z.copy(e);return n.ngElement=r,n.element=r[0],z.isFunction(e.getMarkerScope)&&(n.scope=t),new L.DomMarkers.icon(n)}return v(e)&&v(e.type)&&"icon"===e.type?e.icon:v(e)&&v(e.iconUrl)?new L.Icon(e):new L.Icon.Default({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",shadowUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}function l(e){v(H[e])&&delete H[e]}function p(e){e.options.icon.options.ngElement&&e.options.icon.options.ngElement.remove(),e.options.icon.options.scope&&e.options.icon.options.scope.$destroy()}function g(e,t,r){if(e.closePopup(),e.options.icon&&e.options.icon.options&&"dom"===e.options.icon.options.type&&p(e),v(r)&&v(r.overlays))for(var n in r.overlays)if((r.overlays[n]instanceof L.LayerGroup||r.overlays[n]instanceof L.FeatureGroup)&&r.overlays[n].hasLayer(e))return void r.overlays[n].removeLayer(e);if(v(H))for(var a in H)H[a].hasLayer(e)&&H[a].removeLayer(e);t.hasLayer(e)&&t.removeLayer(e)}function c(e,t,r){(e._popup._contentNode.innerText||e._popup._contentNode.textContent).length<1&&s(function(){c(e,t,r)});var n,a,o,i,l=e._popup._contentNode.offsetWidth;return e._popup._updateLayout(),e._popup._updatePosition(),e._popup.options.autoPan&&(a=r,o=(n=e)._popup._container.offsetHeight,i=new L.Point(n._popup._containerLeft,-o-n._popup._containerBottom),null!==a.layerPointToContainerPoint(i)&&n._popup._adjustPan()),l}function u(e,t,r){var n,a=z.isFunction(t.getMessageScope)?t.getMessageScope():o;if(!v(t.compileMessage)||t.compileMessage){if(!v(e._popup)||!v(e._popup._contentNode))return T.error(x+"Popup is invalid or does not have any content."),!1;n=a,i(e._popup._contentNode)(n),c(e,t,r)}}function y(e,t){var r=z.isFunction(t.getMessageScope)?t.getMessageScope():o,n=z.isFunction(t.getLabelScope)?t.getLabelScope():r,a=!v(t.compileMessage)||t.compileMessage;O.LabelPlugin.isLoaded()&&v(t.label)&&(v(t.label.options)&&!0===t.label.options.noHide&&e.showLabel(),a&&v(e.label)&&i(e.label._container)(n))}function f(e,t,r,n,a,o,i){if(v(t)){if(!S.validateCoords(e))return T.warn("There are problems with lat-lng data, please verify your marker model"),void g(r,i,o);var l=e===t;if(v(e.iconAngle)&&t.iconAngle!==e.iconAngle&&r.setIconAngle(e.iconAngle),M(e.layer)||M(t.layer)&&(v(o.overlays[t.layer])&&o.overlays[t.layer].hasLayer(r)&&(o.overlays[t.layer].removeLayer(r),r.closePopup()),i.hasLayer(r)||i.addLayer(r)),(P(e.opacity)||P(parseFloat(e.opacity)))&&e.opacity!==t.opacity&&r.setOpacity(e.opacity),M(e.layer)&&t.layer!==e.layer){if(M(t.layer)&&v(o.overlays[t.layer])&&o.overlays[t.layer].hasLayer(r)&&o.overlays[t.layer].removeLayer(r),r.closePopup(),i.hasLayer(r)&&i.removeLayer(r),!v(o.overlays[e.layer]))return void T.error(x+"You must use a name of an existing layer");var s=o.overlays[e.layer];if(!(s instanceof L.LayerGroup||s instanceof L.FeatureGroup))return void T.error(x+'A marker can only be added to a layer of type "group" or "featureGroup"');s.addLayer(r),i.hasLayer(r)&&!0===e.focus&&r.openPopup()}if(!0!==e.draggable&&!0===t.draggable&&v(r.dragging)&&r.dragging.disable(),!0===e.draggable&&!0!==t.draggable&&(r.dragging?r.dragging.enable():L.Handler.MarkerDrag&&(r.dragging=new L.Handler.MarkerDrag(r),r.options.draggable=!0,r.dragging.enable())),E(e.icon)||E(t.icon)&&("dom"===t.icon.type&&p(r),r.setIcon(d()),r.closePopup(),r.unbindPopup(),M(e.message)&&r.bindPopup(e.message,e.popupOptions)),E(e.icon)&&E(t.icon)&&!z.equals(e.icon,t.icon)){var c=!1;r.dragging&&(c=r.dragging.enabled()),"dom"===t.icon.type&&p(r),r.setIcon(d(e.icon)),c&&r.dragging.enable(),r.closePopup(),r.unbindPopup(),M(e.message)&&(r.bindPopup(e.message,e.popupOptions),i.hasLayer(r)&&!0===e.focus&&r.openPopup())}!M(e.message)&&M(t.message)&&(r.closePopup(),r.unbindPopup()),O.LabelPlugin.isLoaded()&&(v(e.label)&&v(e.label.message)?"label"in t&&"message"in t.label&&!z.equals(e.label.message,t.label.message)?r.updateLabelContent(e.label.message):(z.isFunction(r.getLabel)&&(!z.isFunction(r.getLabel)||v(r.getLabel()))||r.bindLabel(e.label.message,e.label.options),y(r,e)):"label"in e&&!("message"in e.label)||z.isFunction(r.unbindLabel)&&r.unbindLabel()),M(e.message)&&!M(t.message)&&r.bindPopup(e.message,e.popupOptions),M(e.message)&&M(t.message)&&e.message!==t.message&&r.setPopupContent(e.message);var u=!1;!0!==e.focus&&!0===t.focus&&(r.closePopup(),u=!0),(!0===e.focus&&(!v(t.focus)||!1===t.focus)||l&&!0===e.focus)&&(r.openPopup(),u=!0),t.zIndexOffset!==e.zIndexOffset&&r.setZIndexOffset(e.zIndexOffset);var f=r.getLatLng();M(e.layer)&&O.MarkerClusterPlugin.is(o.overlays[e.layer])?u?e.lat===t.lat&&e.lng===t.lng||(o.overlays[e.layer].removeLayer(r),r.setLatLng([e.lat,e.lng]),o.overlays[e.layer].addLayer(r)):f.lat!==e.lat||f.lng!==e.lng||e.lat!==t.lat||e.lng!==t.lng?(o.overlays[e.layer].removeLayer(r),r.setLatLng([e.lat,e.lng]),o.overlays[e.layer].addLayer(r)):E(e.icon)&&E(t.icon)&&!z.equals(e.icon,t.icon)&&(o.overlays[e.layer].removeLayer(r),o.overlays[e.layer].addLayer(r)):f.lat===e.lat&&f.lng===e.lng||r.setLatLng([e.lat,e.lng])}}var v=e.isDefined,m=e.defaultTo,h=e.MarkerClusterPlugin,b=e.AwesomeMarkersPlugin,k=e.VectorMarkersPlugin,w=e.MakiMarkersPlugin,C=e.ExtraMarkersPlugin,A=e.DomMarkersPlugin,D=e.safeApply,O=e,M=e.isString,P=e.isNumber,E=e.isObject,H={},S=r,x=e.errorHeader,B=n.maybeWatch,T=t;return{resetMarkerGroup:l,resetMarkerGroups:function(){H={}},resetUnusedMarkerGroups:function(){for(var e in H)t=e,0<z.element(H[t]._map._container).parent().length||l(e);var t},deleteMarker:g,manageOpenPopup:u,manageOpenLabel:y,createMarker:function(e){if(v(e)&&S.validateCoords(e)){var t=S.getCoords(e);if(v(t)){var r={icon:d(e.icon),title:v(e.title)?e.title:"",draggable:!!v(e.draggable)&&e.draggable,clickable:!v(e.clickable)||e.clickable,riseOnHover:!!v(e.riseOnHover)&&e.riseOnHover,zIndexOffset:v(e.zIndexOffset)?e.zIndexOffset:0,iconAngle:v(e.iconAngle)?e.iconAngle:0};for(var n in e)e.hasOwnProperty(n)&&!r.hasOwnProperty(n)&&(r[n]=e[n]);var a=new L.marker(t,r);return M(e.message)||a.unbindPopup(),a}T.error(x+"Unable to get coordinates from markerData.")}else T.error(x+"The marker definition is not valid.")},addMarkerToGroup:function(e,t,r,n){M(t)?h.isLoaded()?(v(H[t])||(H[t]=new L.MarkerClusterGroup(r),n.addLayer(H[t])),H[t].addLayer(e)):T.error(x+"The MarkerCluster plugin is not loaded."):T.error(x+"The marker group you have specified is invalid.")},listenMarkerEvents:function(e,t,r,n,a){e.on("popupopen",function(){D(r,function(){(v(e._popup)||v(e._popup._contentNode))&&(t.focus=!0,u(e,t,a))})}),e.on("popupclose",function(){D(r,function(){t.focus=!1})}),e.on("add",function(){D(r,function(){"label"in t&&y(e,t)})})},updateMarker:f,addMarkerWatcher:function(n,e,t,a,o,r){var i=O.getObjectArrayPath("markers."+e);B(t,i,r,function(e,t,r){if(!v(e))return g(n,o,a),void r();f(e,t,n,0,0,a,o)})},string:a,log:function(e,t){(t?console:T).debug(a(e))},getModelFromModels:function(e,t,r){if(v(e)){if(t)return r?e[r][t]:e[t];T.error(x+"marker id missing in getMarker")}},getLayerModels:function(e,t){if(v(e))return t?e[t]:e}}}]),z.module("ui-leaflet").factory("leafletPathsHelpers",["$rootScope","leafletLogger","leafletHelpers",function(e,t,r){var l=r.isDefined,a=r.isArray,n=r.isNumber,o=r.isValidPoint,s=t,c=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"];function i(e){return e.filter(function(e){return o(e)}).map(function(e){return u(e)})}function u(e){return a(e)?new L.LatLng(e[0],e[1]):new L.LatLng(e.lat,e.lng)}function f(e){return e.map(function(e){return i(e)})}function d(e,t){for(var r={},n=0;n<c.length;n++){var a=c[n];l(t[a])&&(r[a]=t[a])}e.setStyle(t)}function p(e){if(!a(e))return!1;for(var t=0;t<e.length;t++){var r=e[t];if(!o(r))return!1}return!0}var g={polyline:{isValid:function(e){var t=e.latlngs;return p(t)},createPath:function(e){return new L.Polyline([],e)},setPath:function(e,t){e.setLatLngs(i(t.latlngs)),d(e,t)}},multiPolyline:{isValid:function(e){var t=e.latlngs;if(!a(t))return!1;for(var r in t){var n=t[r];if(!p(n))return!1}return!0},createPath:function(e){return new L.multiPolyline([[[0,0],[1,1]]],e)},setPath:function(e,t){e.setLatLngs(f(t.latlngs)),d(e,t)}},polygon:{isValid:function(e){var t=e.latlngs;return p(t)},createPath:function(e){return new L.Polygon([],e)},setPath:function(e,t){e.setLatLngs(i(t.latlngs)),d(e,t)}},multiPolygon:{isValid:function(e){var t=e.latlngs;if(!a(t))return!1;for(var r in t){var n=t[r];if(!p(n))return!1}return!0},createPath:function(e){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],e)},setPath:function(e,t){e.setLatLngs(f(t.latlngs)),d(e,t)}},rectangle:{isValid:function(e){var t=e.latlngs;if(!a(t)||2!==t.length)return!1;for(var r in t){var n=t[r];if(!o(n))return!1}return!0},createPath:function(e){return new L.Rectangle([[0,0],[1,1]],e)},setPath:function(e,t){e.setBounds(new L.LatLngBounds(i(t.latlngs))),d(e,t)}},circle:{isValid:function(e){var t=e.latlngs;return o(t)&&n(e.radius)},createPath:function(e){return new L.Circle([0,0],1,e)},setPath:function(e,t){e.setLatLng(u(t.latlngs)),l(t.radius)&&e.setRadius(t.radius),d(e,t)}},circleMarker:{isValid:function(e){var t=e.latlngs;return o(t)&&n(e.radius)},createPath:function(e){return new L.CircleMarker([0,0],e)},setPath:function(e,t){e.setLatLng(u(t.latlngs)),l(t.radius)&&e.setRadius(t.radius),d(e,t)}}};return{setPathOptions:function(e,t,r){l(t)||(t="polyline"),g[t].setPath(e,r)},createPath:function(e,t,r){l(t.type)||(t.type="polyline");var n,a,o=function(e,t){for(var r={},n=0;n<c.length;n++){var a=c[n];l(e[a])?r[a]=e[a]:l(t.path[a])&&(r[a]=t.path[a])}return r}(t,r),i=(a={},(n=t).latlngs&&(a.latlngs=n.latlngs),n.radius&&(a.radius=n.radius),a);if(g[t.type].isValid(i))return g[t.type].createPath(o);s.error("[AngularJS - Leaflet] Invalid data passed to the "+t.type+" path")}}}]),z.module("ui-leaflet").service("leafletWatchHelpers",function(){return{maybeWatch:function(e,t,r,n){var a,o,i,l,s;return a="watchCollection"===r.type?"$watchCollection":"$watch",o=t,i=r,l=n,s=e[a](o,function(e,t){l(e,t,s),null===i.type&&s()},"watchDeep"===i.type)}}}),z.module("ui-leaflet").service("leafletLogger",["nemSimpleLogger",function(e){return e.spawn()}]),z.module("ui-leaflet").factory("nominatimService",["$q","$http","leafletHelpers","leafletMapDefaults",function(a,o,e,i){var l=e.isDefined;return{query:function(e,t){var r=i.getDefaults(t).nominatim.server,n=a.defer();return o.get(r,{params:{format:"json",limit:1,q:e}}).success(function(e){0<e.length&&l(e[0].boundingbox)?n.resolve(e[0]):n.reject("[Nominatim] Invalid address")}),n.promise}}}]),z.module("ui-leaflet").directive("bounds",["leafletLogger","$timeout","$http","leafletHelpers","nominatimService","leafletBoundsHelpers",function(e,u,t,o,f,d){var p=e;return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(n,e,a,t){var i=o.isDefined,l=d.createLeafletBounds,s=t[0].getLeafletScope(),r=t[0],c=o.errorHeader+" [Bounds] ";r.getMap().then(function(o){var r;s.$on("boundsChanged",function(e){var t=e.currentScope,r=o.getBounds();if(!(0===(n=r)._southWest.lat&&0===n._southWest.lng&&0===n._northEast.lat&&0===n._northEast.lng||t.settingBoundsFromScope)){var n;t.settingBoundsFromLeaflet=!0;var a={northEast:{lat:r._northEast.lat,lng:r._northEast.lng},southWest:{lat:r._southWest.lat,lng:r._southWest.lng},options:r.options};z.equals(t.bounds,a)||(t.bounds=a),u(function(){t.settingBoundsFromLeaflet=!1})}}),s.$watch("bounds",function(e){if(!n.settingBoundsFromLeaflet){if(i(e.address)&&e.address!==r)return n.settingBoundsFromScope=!0,f.query(e.address,a.id).then(function(e){var t=e.boundingbox,r=[[t[0],t[2]],[t[1],t[3]]];o.fitBounds(r)},function(e){p.error(c+" "+e+".")}),r=e.address,void u(function(){n.settingBoundsFromScope=!1});var t=l(e);t&&!o.getBounds().equals(t)&&(n.settingBoundsFromScope=!0,o.fitBounds(t,e.options),u(function(){n.settingBoundsFromScope=!1}))}},!0)})}}}]);var e=["center","lfCenter"],t={};e.forEach(function(D){t[D]=["leafletLogger","$q","$location","$timeout","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletMapEvents",function(e,t,u,f,d,r,p,g){var y,v=r.isDefined,m=r.isNumber,h=r.isSameCenterOnMap,L=r.safeApply,b=r.isValidCenter,k=p.isValidBounds,w=r.isUndefinedOrEmpty,C=r.errorHeader,A=e;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){y=t.defer(),this.getCenter=function(){return y.promise}},link:function(e,t,l,r){var s=r.getLeafletScope(),c=s[D];r.getMap().then(function(n){var e,t,r,a,o=d.getDefaults(l.id);if(-1!==l[D].search("-"))return A.error(C+' The "center" variable can\'t use a "-" on its key name: "'+l[D]+'".'),void n.setView([o.center.lat,o.center.lng],o.center.zoom);if(e=s.bounds,t=c,v(e)&&k(e)&&w(t))n.fitBounds(p.createLeafletBounds(s.bounds),s.bounds.options),c=n.getCenter(),L(s,function(e){z.extend(e[D],{lat:n.getCenter().lat,lng:n.getCenter().lng,zoom:n.getZoom(),autoDiscover:!1})}),L(s,function(e){var t=n.getBounds();e.bounds={northEast:{lat:t._northEast.lat,lng:t._northEast.lng},southWest:{lat:t._southWest.lat,lng:t._southWest.lng}}});else{if(!v(c))return A.error(C+' The "center" property is not defined in the main scope'),void n.setView([o.center.lat,o.center.lng],o.center.zoom);v(c.lat)&&v(c.lng)||v(c.autoDiscover)||z.copy(o.center,c)}if("yes"===l.urlHashCenter){var i=function(){var e,t=u.search(),r=l.urlHashParam?l.urlHashParam:"c";if(v(t[r])){var n=t[r].split(":");3===n.length&&(e={lat:parseFloat(n[0]),lng:parseFloat(n[1]),zoom:parseInt(n[2],10)})}return e};r=i(),s.$on("$locationChangeSuccess",function(e){var t=e.currentScope,r=i();v(r)&&!h(r,n)&&z.extend(t[D],{lat:r.lat,lng:r.lng,zoom:r.zoom})})}s.$watch(D,function(e){if(!s.settingCenterFromLeaflet){if(v(r)&&(z.copy(r,e),r=void 0),b(e)||!0===e.autoDiscover)return!0===e.autoDiscover?(m(e.zoom)||n.setView([o.center.lat,o.center.lng],o.center.zoom),void(m(e.zoom)&&e.zoom>o.center.zoom?n.locate({setView:!0,maxZoom:e.zoom}):v(o.maxZoom)?n.locate({setView:!0,maxZoom:o.maxZoom}):n.locate({setView:!0}))):void(a&&h(e,n)||(s.settingCenterFromScope=!0,n.setView([e.lat,e.lng],e.zoom),g.notifyCenterChangedToBounds(s,n),f(function(){s.settingCenterFromScope=!1})));A.warn(C+" invalid 'center'")}},!0),n.whenReady(function(){a=!0}),n.on("moveend",function(){y.resolve(),g.notifyCenterUrlHashChanged(s,n,l,u.search()),h(c,n)||s.settingCenterFromScope||(s.settingCenterFromLeaflet=!0,L(s,function(e){s.settingCenterFromScope||z.extend(e[D],{lat:n.getCenter().lat,lng:n.getCenter().lng,zoom:n.getZoom(),autoDiscover:!1}),g.notifyCenterChangedToBounds(s,n),f(function(){s.settingCenterFromLeaflet=!1})}))}),!0===c.autoDiscover&&n.on("locationerror",function(){A.warn(C+" The Geolocation API is unauthorized on this page."),b(c)?n.setView([c.lat,c.lng],c.zoom):n.setView([o.center.lat,o.center.lng],o.center.zoom),g.notifyCenterChangedToBounds(s,n)})})}}}]}),e.forEach(function(e){z.module("ui-leaflet").directive(e,t[e])}),z.module("ui-leaflet").directive("controls",["leafletLogger","leafletHelpers","leafletControlHelpers",function(e,o,i){var y=e;return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(e,t,r,n){if(n){var c=i.createControl,u=i.isValidControlType,a=n.getLeafletScope(),f=o.isDefined,d=o.isArray,p={},g=o.errorHeader+" [Controls] ";e.$on("$destroy",function(){i.destroyMapLayersControl(e.mapId)}),n.getMap().then(function(s){a.$watchCollection("controls",function(e){for(var t in p)f(e[t])||(s.hasControl(p[t])&&s.removeControl(p[t]),delete p[t]);for(var r in e){var n,a=f(e[r].type)?e[r].type:r;if(!u(a))return void y.error(g+" Invalid control type: "+a+".");if("custom"!==a)n=c(a,e[r]),s.addControl(n),p[r]=n;else{var o=e[r];if(d(o))for(var i=0;i<o.length;i++){var l=o[i];s.addControl(l),p[r]=f(p[r])?p[r].concat([l]):[l]}else s.addControl(o),p[r]=o}}})})}}}}]),z.module("ui-leaflet").directive("decorations",["leafletLogger","leafletHelpers",function(e,o){var d=e;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,t,r,n){var a=n.getLeafletScope(),c=o.PolylineDecoratorPlugin,u=o.isDefined,f={};n.getMap().then(function(s){a.$watch("decorations",function(e){for(var t in f)u(e[t])&&z.equals(e[t],f)||(s.removeLayer(f[t]),delete f[t]);for(var r in e){var n=e[r],a=(u(l=n)&&u(l.coordinates)&&(c.isLoaded()||d.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(l.coordinates));u(a)&&(f[r]=a,s.addLayer(a),i=n,u(o=a)&&u(i)&&u(i.coordinates)&&u(i.patterns)&&(o.setPaths(i.coordinates),o.setPatterns(i.patterns)))}var o,i,l},!0)})}}}]),z.module("ui-leaflet").directive("eventBroadcast",["leafletLogger","$rootScope","leafletHelpers","leafletMapEvents","leafletIterators",function(e,t,u,f,d){var p=e;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,t,n,r){var a=u.isObject,o=u.isDefined,i=r.getLeafletScope(),l=i.eventBroadcast,s=f.getAvailableMapEvents(),c=f.addEvents;r.getMap().then(function(e){var t=[],r="broadcast";o(l.map)?a(l.map)?("emit"!==l.map.logic&&"broadcast"!==l.map.logic?p.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):r=l.map.logic,a(l.map.enable)&&0<=l.map.enable.length?d.each(l.map.enable,function(e){-1===t.indexOf(e)&&-1!==s.indexOf(e)&&t.push(e)}):p.warn("[AngularJS - Leaflet] event-broadcast.map.enable must be an object check your model.")):p.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model."):t=s,c(e,n.id,t,"eventName",i,r)})}}}]),z.module("ui-leaflet").directive("geojson",["$timeout","leafletLogger","leafletData","leafletHelpers","leafletWatchHelpers","leafletDirectiveControlsHelpers","leafletIterators","leafletGeoJsonEvents",function(e,t,d,p,r,n,a,g){var o=r.maybeWatch,y=p.watchOptions,v=n.extend,m=p,h=a,b={changeFromDirective:!1};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,t,l,r){var s=p.isDefined,c=r.getLeafletScope(),u={},f=!1;r.getMap().then(function(i){var e;e=c.watchOptions&&c.watchOptions.geojson?c.watchOptions.geojson:y;function t(){if(u){var t=function(e){s(e)&&i.hasLayer(e)&&i.removeLayer(e)};a?h.each(u,function(e){t(e)}):t(u)}}function r(e,t){if(s(e)&&s(e.data)){var r,n,a=(r=e,n=t,z.isFunction(r.onEachFeature)?r.onEachFeature:function(e,t){p.LabelPlugin.isLoaded()&&s(e.properties.description)&&t.bindLabel(e.properties.description),g.bindEvents(l.id,t,null,e,c,n,{resetStyleOnMouseout:r.resetStyleOnMouseout,mapId:l.id})});s(e.options)||m.modelChangeInDirective(b,"changeFromDirective",function(){e.options={style:e.style,filter:e.filter,onEachFeature:a,pointToLayer:e.pointToLayer}});var o=L.geoJson(e.data,e.options);t&&m.isString(t)?u[t]=o:u=o,o.addTo(i),f||(f=!0,d.setGeoJSON(u,l.id))}}function n(e){if(t(),a){if(!e||!Object.keys(e).length)return;h.each(e,function(e,t){r(e,t)})}else r(e)}var a=m.isDefined(l.geojsonNested)&&m.isTruthy(l.geojsonNested);v(l.id,"geojson",n,t),o(c,"geojson",e,function(e){b.changeFromDirective||n(e)})})}}}]),z.module("ui-leaflet").directive("layercontrol",["$filter","leafletLogger","leafletData","leafletHelpers",function(e,t,s,o){var n=t;return{restrict:"E",scope:{icons:"=?",autoHideOpacity:"=?",showGroups:"=?",title:"@",baseTitle:"@",overlaysTitle:"@"},replace:!0,transclude:!1,require:"^leaflet",controller:["$scope","$element","$sce",function(i,e,t){n.debug("[Angular Directive - Layers] layers",i,e);var l=o.safeApply,a=o.isDefined;z.extend(i,{baselayer:"",oldGroup:"",layerProperties:{},groupProperties:{},rangeIsSupported:o.rangeIsSupported(),changeBaseLayer:function(a,e){o.safeApply(i,function(n){n.baselayer=a,s.getMap().then(function(r){s.getLayers().then(function(e){if(!r.hasLayer(e.baselayers[a])){for(var t in n.layers.baselayers)n.layers.baselayers[t].icon=n.icons.unradio,r.hasLayer(e.baselayers[t])&&r.removeLayer(e.baselayers[t]);r.addLayer(e.baselayers[a]),n.layers.baselayers[a].icon=i.icons.radio}})})}),e.preventDefault()},moveLayer:function(e,t,r){var n=Object.keys(i.layers.baselayers).length;if(1+n<=t&&t<=i.overlaysArray.length+n){var a;for(var o in i.layers.overlays)if(i.layers.overlays[o].index===t){a=i.layers.overlays[o];break}a&&l(i,function(){a.index=e.index,e.index=t})}r.stopPropagation(),r.preventDefault()},initIndex:function(e,t){var r=Object.keys(i.layers.baselayers).length;e.index=a(e.index)?e.index:t+r+1},initGroup:function(e){i.groupProperties[e]=i.groupProperties[e]?i.groupProperties[e]:{}},toggleOpacity:function(e,t){if(t.visible){if(i.autoHideOpacity&&!i.layerProperties[t.name].opacityControl)for(var r in i.layerProperties)i.layerProperties[r].opacityControl=!1;i.layerProperties[t.name].opacityControl=!i.layerProperties[t.name].opacityControl}e.stopPropagation(),e.preventDefault()},toggleLegend:function(e){i.layerProperties[e.name].showLegend=!i.layerProperties[e.name].showLegend},showLegend:function(e){return e.legend&&i.layerProperties[e.name].showLegend},unsafeHTML:function(e){return t.trustAsHtml(e)},getOpacityIcon:function(e){return e.visible&&i.layerProperties[e.name].opacityControl?i.icons.close:i.icons.open},getGroupIcon:function(e){return e.visible?i.icons.check:i.icons.uncheck},changeGroupVisibility:function(e){if(a(i.groupProperties[e])){var t=i.groupProperties[e].visible;for(var r in i.layers.overlays){var n=i.layers.overlays[r];n.group===e&&(n.visible=t)}}}});var r=e.get(0);L.Browser.touch?L.DomEvent.on(r,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(r),L.DomEvent.on(r,"mousewheel",L.DomEvent.stopPropagation))}],template:'<div class="angular-leaflet-control-layers" ng-show="overlaysArray.length"><h4 ng-if="title">{{ title }}</h4><div class="lf-baselayers"><h5 class="lf-title" ng-if="baseTitle">{{ baseTitle }}</h5><div class="lf-row" ng-repeat="(key, layer) in baselayersArray"><label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)"><input class="leaflet-control-layers-selector" type="radio" name="lf-radio" ng-show="false" ng-checked="baselayer === key" ng-value="key" /> <i class="lf-icon lf-icon-radio" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div></label></div></div><div class="lf-overlays"><h5 class="lf-title" ng-if="overlaysTitle">{{ overlaysTitle }}</h5><div class="lf-container"><div class="lf-row" ng-repeat="layer in (o = (overlaysArray | orderBy:\'index\':order))" ng-init="initIndex(layer, $index)"><label class="lf-icon-ol-group" ng-if="showGroups &amp;&amp; layer.group &amp;&amp; layer.group != o[$index-1].group"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-change="changeGroupVisibility(layer.group)" ng-model="groupProperties[layer.group].visible"/> <i class="lf-icon lf-icon-check" ng-class="getGroupIcon(groupProperties[layer.group])"></i><div class="lf-text">{{ layer.group }}</div></label><label class="lf-icon-ol"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/> <i class="lf-icon lf-icon-check" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div></label><div class="lf-icons"><i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"></i> <i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"></i> <i class="lf-icon lf-toggle-legend" ng-class="icons.toggleLegend" ng-if="layer.legend" ng-click="toggleLegend(layer)"></i> <i class="lf-icon lf-open" ng-class="getOpacityIcon(layer)" ng-click="toggleOpacity($event, layer)"></i></div><div class="lf-legend" ng-if="showLegend(layer)" ng-bind-html="unsafeHTML(layer.legend)"></div><div class="lf-opacity clearfix" ng-if="layer.visible &amp;&amp; layerProperties[layer.name].opacityControl"><label ng-if="rangeIsSupported" class="pull-left" style="width: 50%">0</label><label ng-if="rangeIsSupported" class="pull-left text-right" style="width: 50%">100</label><input ng-if="rangeIsSupported" class="clearfix" type="range" min="0" max="1" step="0.05" class="lf-opacity-control" ng-model="layerProperties[layer.name].layerOptions.opacity"/><h6 ng-if="!rangeIsSupported">Range is not supported in this browser</h6></div></div></div></div></div>',link:function(i,e,t,r){var l=o.isDefined,n=r.getLeafletScope(),a=n.layers;i.$watch("icons",function(){var e={uncheck:"fa fa-square-o",check:"fa fa-check-square-o",radio:"fa fa-dot-circle-o",unradio:"fa fa-circle-o",up:"fa fa-angle-up",down:"fa fa-angle-down",open:"fa fa-angle-double-down",close:"fa fa-angle-double-up",toggleLegend:"fa fa-pencil-square-o"};l(i.icons)?(z.extend(e,i.icons),z.extend(i.icons,e)):i.icons=e}),t.order=!l(t.order)||"normal"!==t.order&&"reverse"!==t.order?"normal":t.order,i.order="normal"===t.order,i.orderNumber="normal"===t.order?-1:1,i.layers=a,r.getMap().then(function(o){n.$watch("layers.baselayers",function(n){var a={};s.getLayers().then(function(e){var t;for(t in n){var r=n[t];r.icon=i.icons[o.hasLayer(e.baselayers[t])?"radio":"unradio"],a[t]=r}i.baselayersArray=a})}),n.$watch("layers.overlays",function(r){var n=[],a={};s.getLayers().then(function(){var e;for(e in r){var t=r[e];t.icon=i.icons[t.visible?"check":"uncheck"],n.push(t),l(i.layerProperties[t.name])||(l(t.layerOptions.opacity)&&(t.layerOptions.opacity=1),i.layerProperties[t.name]={opacityControl:!1,showLegend:!0,layerOptions:t.layerOptions}),l(t.group)&&(l(i.groupProperties[t.group])||(i.groupProperties[t.group]={visible:!1}),a[t.group]=l(a[t.group])?a[t.group]:{count:0,visibles:0},a[t.group].count++,t.visible&&a[t.group].visibles++)}for(e in a)i.groupProperties[e].visible=a[e].visibles===a[e].count;i.overlaysArray=n})},!0)})}}}]),z.module("ui-leaflet").directive("layers",["leafletLogger","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(e,t,h,r,n,l){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:["$scope",function(e){e._leafletLayers=t.defer(),this.getLayers=function(){return e._leafletLayers.promise}}],link:function(a,e,o,t){var c=r.isDefined,u={},i=t.getLeafletScope(),f=i.layers,d=n.createLayer,p=n.safeAddLayer,g=n.safeRemoveLayer,y=n.changeOpacityListener,v=l.updateLayersControl,m=!1;a.$on("$destroy",function(){l.destroyMapLayersControl(a.mapId)}),t.getMap().then(function(l){a._leafletLayers.resolve(u),h.setLayers(u,o.id),u.baselayers={},u.overlays={};var s=o.id,e=!1;for(var t in f.baselayers){var r=d(f.baselayers[t]);c(r)?(u.baselayers[t]=r,!0===f.baselayers[t].top&&(p(l,u.baselayers[t]),e=!0)):delete f.baselayers[t]}for(t in!e&&0<Object.keys(u.baselayers).length&&p(l,u.baselayers[Object.keys(f.baselayers)[0]]),f.overlays){f.overlays[t].type;var n=d(f.overlays[t]);c(n)?(u.overlays[t]=n,!0===f.overlays[t].visible&&p(l,u.overlays[t])):delete f.overlays[t]}i.$watch("layers.baselayers",function(e,t){if(z.equals(e,t))return m=v(l,s,m,e,f.overlays,u),!0;for(var r in u.baselayers)c(e[r])&&!e[r].doRefresh||(l.hasLayer(u.baselayers[r])&&l.removeLayer(u.baselayers[r]),delete u.baselayers[r],e[r]&&e[r].doRefresh&&(e[r].doRefresh=!1));for(var n in e)if(c(u.baselayers[n]))!0!==e[n].top||l.hasLayer(u.baselayers[n])?!1===e[n].top&&l.hasLayer(u.baselayers[n])&&l.removeLayer(u.baselayers[n]):p(l,u.baselayers[n]);else{var a=d(e[n]);c(a)&&(u.baselayers[n]=a,!0===e[n].top&&p(l,u.baselayers[n]))}var o=!1;for(var i in u.baselayers)if(l.hasLayer(u.baselayers[i])){o=!0;break}!o&&0<Object.keys(u.baselayers).length&&p(l,u.baselayers[Object.keys(u.baselayers)[0]]),m=v(l,s,m,e,f.overlays,u)},!0),i.$watch("layers.overlays",function(e,t){if(z.equals(e,t))return m=v(l,s,m,f.baselayers,e,u),!0;for(var r in u.overlays)if(!c(e[r])||e[r].doRefresh){if(l.hasLayer(u.overlays[r])){var n=c(e[r])?e[r].layerOptions:null;g(l,u.overlays[r],n)}delete u.overlays[r],e[r]&&e[r].doRefresh&&(e[r].doRefresh=!1)}for(var a in e){if(c(u.overlays[a])){e[a].visible&&!l.hasLayer(u.overlays[a])?p(l,u.overlays[a]):!1===e[a].visible&&l.hasLayer(u.overlays[a])&&g(l,u.overlays[a],e[a].layerOptions);var o=u.overlays[a];l.hasLayer(u.overlays[a])&&(e[a].layerOptions.opacity!==t[a].layerOptions.opacity&&(c(o.setOpacity)&&o.setOpacity(e[a].layerOptions.opacity),c(o.getLayers)&&c(o.eachLayer)&&o.eachLayer(y(e[a].layerOptions.opacity))),c(e[a].index)&&o.setZIndex&&e[a].index!==t[a].index&&o.setZIndex(e[a].index))}else{var i=d(e[a]);if(!c(i))continue;u.overlays[a]=i,!0===e[a].visible&&p(l,u.overlays[a]),c(e[a].index)&&u.overlays[a].setZIndex&&u.overlays[a].setZIndex(e[a].index)}e[a].visible&&l._loaded&&e[a].data&&"heatmap"===e[a].type&&(u.overlays[a].setData(e[a].data),u.overlays[a].update())}m=v(l,s,m,f.baselayers,e,u)},!0)})}}}]),z.module("ui-leaflet").directive("legend",["leafletLogger","$http","$timeout","leafletHelpers","leafletLegendHelpers",function(e,t,r,y,v){var m=e,h=y.errorHeader+" [Legend] ";return{restrict:"A",scope:!1,replace:!1,require:"leaflet",transclude:!1,link:function(e,t,l,r){var n,a,o,s,c=y.isArray,u=y.isString,f=y.isDefined,i=y.isFunction,d=r.getLeafletScope(),p=d.legend;d.$watch("legend",function(e){f(e)&&(n=e.legendClass?e.legendClass:"legend",a=e.position||"bottomright",s=e.type||"arcgis")},!0);function g(e,t,r){t&&t.layers&&0<t.layers.length&&(f(o)?v.updateLegend(o.getContainer(),t,s,r):((o=L.control({position:a})).onAdd=v.getOnAddLegend(t,n,s,r),o.addTo(e)),f(p.loadedData)&&i(p.loadedData)&&p.loadedData())}r.getMap().then(function(i){d.$watch("legend",function(e){f(e)?f(e.url)||"arcgis"!==s||c(e.colors)&&c(e.labels)&&e.colors.length===e.labels.length?f(e.url)?m.info(h+" loading legend service."):(f(o)&&(o.removeFrom(i),o=null),o=L.control({position:a}),"arcgis"===s&&(o.onAdd=v.getOnAddArrayLegend(e,n)),o.addTo(i)):m.warn(h+" legend.colors and legend.labels must be set."):f(o)&&(o.removeFrom(i),o=null)}),d.$watch("legend.url",function(n){if(f(n))if(c(n)||u(n))for(var a,o=u(n)?[n]:n,e=function(t,r){return function(e){f(e.data.error)?m.warn(h+"Error loadin legend from: "+r,e.data.error.message):a&&a.layers&&0<a.layers.length?a.layers=a.layers.concat(e.data.layers):a=e.data,t===o.length-1&&g(i,a,n)}},t=function(e){m.warn(h+" legend.url not loaded.",e)},r=0;r<o.length;r++)v.addLegendURL(l.id,{url:o[r],method:"GET"}).then(e(r)).catch(t);else m.warn(h+" legend.url must be an array or string.")}),d.$watch("legend.legendData",function(e){m.debug("legendData",e),!f(d.legend.url)&&f(e)&&g(i,e)},!0)})}}}]),z.module("ui-leaflet").directive("markers",["leafletLogger","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletMarkerEvents","leafletIterators","leafletWatchHelpers","leafletDirectiveControlsHelpers",function(e,t,a,o,r,n,i,k,l,s,c){function p(d,e,p,g,y,v,m,h,b,t){x.each(e,function(s,c){if(!t[c])if(-1===c.search("-")){var u=A.getObjectDotPath(b?[b,c]:[c]),f=function(e,t,r){if(Object.keys(e).length){if(r&&D(r)){if(!e[r]||!Object.keys(e[r]).length)return;return e[r][t]}return e[t]}}(v,c,b);A.modelChangeInDirective(F,"changeFromDirective",function(){if(w(f)){var e=S(p,c,b);M(s,e,f,u,m,y,g)}else{var t=H(s),r=(s?s.layer:void 0)||b;if(!w(t))return void T.error(C+" Received invalid data on the marker "+c+".");if(a=t,o=v,i=c,(l=b)&&D(l)?(w(o[l])||(o[l]={}),o[l][i]=a):o[i]=a,w(s.message)&&t.bindPopup(s.message,s.popupOptions),w(s.tooltip)&&t.bindTooltip(s.tooltip.text,s.tooltip.options),w(s.group)){var n=w(s.groupOption)?s.groupOption:null;E(t,s.group,n,g)}if(A.LabelPlugin.isLoaded()&&w(s.label)&&w(s.label.message)&&t.bindLabel(s.label.message,s.label.options),w(s)&&(w(s.layer)||w(b))){if(!function(e,t,r,n,a,o){if(!D(e))return T.error(C+" A layername must be a string"),!1;if(!w(t))return T.error(C+" You must add layers to the directive if the markers are going to use this functionality."),!1;if(!w(t.overlays)||!w(t.overlays[e]))return T.error(C+' A marker can only be added to a layer of type "group"'),!1;var i=t.overlays[e];return i instanceof L.LayerGroup||i instanceof L.FeatureGroup?(i.addLayer(n),null===a&&o.hasLayer(n)&&!0===r.focus&&n.openPopup(),!0):(T.error(C+' Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"'),!1)}(r,y,s,t,h.individual.type,g))return}else w(s.group)||(g.addLayer(t),null===h.individual.type&&!0===s.focus&&t.openPopup());null!==h.individual.type&&O(t,u,m,y,g,h.individual),P(t,s,m,h.individual.type,g),k.bindEvents(d,t,u,s,m,r)}var a,o,i,l})}else T.error('The marker can\'t use a "-" on his key name: "'+c+'".')})}function u(e,t,r,n,a){var o,i,l=!1,s=!1,c=w(t);for(var u in r)l||(T.debug(C+"[markers] destroy: "),l=!0),c&&(i=e[u],o=t[u],s=n&&z.equals(i,o)),w(e)&&Object.keys(e).length&&w(e[u])&&Object.keys(e[u]).length&&!s||a&&A.isFunction(a)&&a(i,o,u)}function g(e,t,n,a,o){u(e,t,n,!1,function(e,t,r){T.debug(C+"[marker] is deleting marker: "+r),f(n[r],a,o),delete n[r]})}function y(e,t,r){var n={};return u(e,t,r,!0,function(e,t,r){T.debug(C+"[marker] is already rendered, marker: "+r),n[r]=e}),n}var w=r.isDefined,C=r.errorHeader,A=r,D=r.isString,O=i.addMarkerWatcher,M=i.updateMarker,P=i.listenMarkerEvents,E=i.addMarkerToGroup,H=i.createMarker,f=i.deleteMarker,S=i.getModelFromModels,v=i.getLayerModels,m=i.resetUnusedMarkerGroups,x=l,h=r.watchOptions,b=s.maybeWatch,B=c.extend,T=e,F={changeFromDirective:!1};return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(n,e,f,r){var t=r[0],d=t.getLeafletScope();t.getMap().then(function(s){var e,c,u={};e=w(r[1])?r[1].getLayers:function(){var e=a.defer();return e.resolve(),e.promise},c=d.watchOptions&&d.watchOptions.markers?d.watchOptions.markers:h;var t=w(f.markersNested)&&A.isTruthy(f.markersNested);e().then(function(l){function e(e,n){m(),t?x.each(e,function(e,t){var r=v(n,t);g(e,r,u[t],s,l)}):g(e,n,u,s,l)}function r(a,o){e(a,o);var i=null;t?x.each(a,function(e,t){var r=v(o,t),n=v(a,t);i=y(n,r,u[t]),p(f.id,e,o,s,l,u,d,c,t,i)}):(i=y(a,o,u),p(f.id,a,o,s,l,u,d,c,void 0,i))}B(f.id,"markers",r,e),o.setMarkers(u,f.id),b(d,"markers",c,function(e,t){F.changeFromDirective||r(e,t)}),n.$on("$destroy",function(){g(d.markers,{},u,s,l)})})})}}}]),z.module("ui-leaflet").directive("maxbounds",["leafletLogger","leafletMapDefaults","leafletBoundsHelpers","leafletHelpers",function(e,t,l,s){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,t,n,r){var a=r.getLeafletScope(),o=l.isValidBounds,i=s.isNumber;r.getMap().then(function(r){a.$watch("maxbounds",function(e){if(o(e)){var t=l.createLeafletBounds(e);i(e.pad)&&(t=t.pad(e.pad)),r.setMaxBounds(t),n.center||n.lfCenter||r.fitBounds(t)}else r.setMaxBounds()})})}}}]),z.module("ui-leaflet").directive("paths",["leafletLogger","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletPathEvents","leafletWatchHelpers",function(e,o,b,i,k,l,s,c){var w=e;return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(e,t,f,r){var n=r[0],d=k.isDefined,p=k.isString,g=n.getLeafletScope(),a=g.paths,y=l.createPath,v=s.bindPathEvents,m=l.setPathOptions,h=c.maybeWatch;n.getMap().then(function(s){var e,c=i.getDefaults(f.id);if(e=d(r[1])?r[1].getLayers:function(){var e=o.defer();return e.resolve(),e.promise},d(a)){var u;u=g.watchOptions&&g.watchOptions.paths?g.watchOptions.paths:{type:"watchCollection",individual:{type:"watchDeep"}},e().then(function(o){var i={};b.setPaths(i,f.id);function l(a,e,t){h(g,'paths["'+e+'"]',t,function(e,t,r){if(!d(e)){if(d(t.layer))for(var n in o.overlays){o.overlays[n].removeLayer(a)}return s.removeLayer(a),void r()}m(a,e.type,e)})}function t(e){for(var t in!function(e){for(var t in i)d(e[t])||(s.removeLayer(i[t]),delete i[t])}(e),e)if(0!==t.search("\\$"))if(-1===t.search("-")){if(!d(i[t])){var r=e[t],n=y(t,e[t],c);if(d(n)&&d(r.message)&&n.bindPopup(r.message,r.popupOptions),k.LabelPlugin.isLoaded()&&d(r.label)&&d(r.label.message)&&n.bindLabel(r.label.message,r.label.options),d(r)&&d(r.layer)){if(!p(r.layer)){w.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!d(o)){w.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!d(o.overlays)||!d(o.overlays[r.layer])){w.error('[AngularJS - Leaflet] A path can only be added to a layer of type "group"');continue}var a=o.overlays[r.layer];if(!(a instanceof L.LayerGroup||a instanceof L.FeatureGroup)){w.error('[AngularJS - Leaflet] Adding a path to an overlay needs a overlay of the type "group" or "featureGroup"');continue}i[t]=n,a.addLayer(n),null!==u.individual.type?l(n,t,u.individual):m(n,r.type,r)}else d(n)&&(i[t]=n,s.addLayer(n),null!==u.individual.type?l(n,t,u.individual):m(n,r.type,r));v(f.id,n,t,r,g)}}else w.error('[AngularJS - Leaflet] The path name "'+t+'" is not valid. It must not include "-" and a number.')}h(g,"paths",u,function(e){t(e)})})}})}}}]),z.module("ui-leaflet").directive("tiles",["leafletLogger","leafletData","leafletMapDefaults","leafletHelpers",function(e,c,u,a){var o=e;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,t,i,r){var l=a.isDefined,s=r.getLeafletScope(),n=s.tiles;l(n)&&l(n.url)?r.getMap().then(function(n){var a,o=u.getDefaults(i.id);s.$watch("tiles",function(e){var t=o.tileLayerOptions,r=o.tileLayer;if(l(e.url)||!l(a))return l(a)?l(e.url)&&l(e.options)&&!z.equals(e.options,t)?(n.removeLayer(a),t=o.tileLayerOptions,z.copy(e.options,t),r=e.url,(a=L.tileLayer(r,t)).addTo(n),void c.setTiles(a,i.id)):void(l(e.url)&&a.setUrl(e.url)):(l(e.options)&&z.copy(e.options,t),l(e.url)&&(r=e.url),(a=L.tileLayer(r,t)).addTo(n),void c.setTiles(a,i.id));n.removeLayer(a)},!0)}):o.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]),z.module("ui-leaflet").directive("watchOptions",["$log","$rootScope","$q","leafletData","leafletHelpers",function(e,t,r,n,a){var i=a.isDefined,l=a.errorHeader,s=a.isObject,c=e;return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(e,t,r,n){function a(e){return"watch"===e||"watchCollection"===e||"watchDeep"===e||null===e}var o=n[0].getLeafletScope();i(o.watchOptions)&&s(o.watchOptions)&&z.forEach(["markers","geojson","paths"],function(e){i(o.watchOptions[e])&&(a(o.watchOptions[e].type)||c.error(l+" watchOptions."+e+".type is not a valid type."),i(o.watchOptions[e].individual)?a(o.watchOptions[e].individual.type)||c.error(l+" watchOptions."+e+".individual.type is not a valid type."):c.error(l+" watchOptions."+e+".type.individual must be defined."))})}}}]),z.module("ui-leaflet").factory("leafletEventsHelpersFactory",["$rootScope","$q","leafletLogger","leafletHelpers",function(c,e,t,r){function n(e,t){this.rootBroadcastName=e,y.debug("leafletEventsHelpersFactory: lObjectType: "+t+"rootBroadcastName: "+e),this.lObjectType=t}var u=r.safeApply,f=r.isDefined,d=r.isObject,p=r.isArray,g=r.errorHeader,y=t;return n.prototype.getAvailableEvents=function(){return[]},n.prototype.genDispatchEvent=function(r,n,a,o,i,l,s,c,u){var f=this;return r=(r=r||"")&&"."+r,function(e){var t=f.rootBroadcastName+r+"."+n;y.debug(t),f.fire(o,t,a,e,e.target||i,s,l,c,u)}},n.prototype.fire=function(t,r,n,a,o,i,l,s,e){u(t,function(){var e={leafletEvent:a,leafletObject:o,modelName:l,model:i};f(s)&&z.extend(e,{layerName:s}),"emit"===n?t.$emit(r,e):c.$broadcast(r,e)})},n.prototype.bindEvents=function(t,r,n,a,o,i,l){var s=[],c=this;if(f(o.eventBroadcast))if(d(o.eventBroadcast))if(f(o.eventBroadcast[c.lObjectType]))if(d(o.eventBroadcast[c.lObjectType])){f(o.eventBroadcast[this.lObjectType].logic)&&"emit"!==o.eventBroadcast[c.lObjectType].logic&&"broadcast"!==o.eventBroadcast[c.lObjectType].logic&&y.warn(g+"Available event propagation logic are: 'emit' or 'broadcast'.");var e=!1,u=!1;f(o.eventBroadcast[c.lObjectType].enable)&&p(o.eventBroadcast[c.lObjectType].enable)&&(e=!0),f(o.eventBroadcast[c.lObjectType].disable)&&p(o.eventBroadcast[c.lObjectType].disable)&&(u=!0),e&&u?y.warn(g+"can not enable and disable events at the same time"):e||u?e?o.eventBroadcast[this.lObjectType].enable.forEach(function(e){-1!==s.indexOf(e)?y.warn(g+"This event "+e+" is already enabled"):-1===c.getAvailableEvents().indexOf(e)?y.warn(g+"This event "+e+" does not exist"):s.push(e)}):(s=this.getAvailableEvents(),o.eventBroadcast[c.lObjectType].disable.forEach(function(e){var t=s.indexOf(e);-1===t?y.warn(g+"This event "+e+" does not exist or has been already disabled"):s.splice(t,1)})):y.warn(g+"must enable or disable events")}else y.warn(g+"event-broadcast."+[c.lObjectType]+" must be an object check your model.");else s=this.getAvailableEvents();else y.error(g+"event-broadcast must be an object check your model.");else s=this.getAvailableEvents();return s.forEach(function(e){r.on(e,c.genDispatchEvent(t,e,"emit",o,r,n,a,i,l))}),"emit"},n}]).service("leafletEventsHelpers",["leafletEventsHelpersFactory",function(e){return new e}]),z.module("ui-leaflet").factory("leafletGeoJsonEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpersFactory","leafletData",function(f,e,t,r,n,d){function a(){g.call(this,"leafletDirectiveGeoJson","geojson")}var p=r.safeApply,g=n;return(a.prototype=new g).genDispatchEvent=function(e,r,t,n,a,o,i,l,s){var c=g.prototype.genDispatchEvent.call(this,e,r,t,n,a,o,i,l),u=this;return function(t){"mouseout"===r&&(s.resetStyleOnMouseout&&d.getGeoJSON(s.mapId).then(function(e){(l?e[l]:e).resetStyle(t.target)}),p(n,function(){f.$broadcast(u.rootBroadcastName+".mouseout",t)})),c(t)}},a.prototype.getAvailableEvents=function(){return["click","dblclick","mouseover","mouseout"]},new a}]),z.module("ui-leaflet").factory("leafletLabelEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpersFactory",function(e,t,r,n,a){function o(){c.call(this,"leafletDirectiveLabel","markers")}var f=n,c=a;return(o.prototype=new c).genDispatchEvent=function(e,t,r,n,a,o,i,l){var s=o.replace("markers.","");return c.prototype.genDispatchEvent.call(this,e,t,r,n,a,s,i,l)},o.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},o.prototype.genEvents=function(t,e,r,n,a,o,i,l){var s=this,c=this.getAvailableEvents(),u=f.getObjectArrayPath("markers."+o);c.forEach(function(e){a.label.on(e,s.genDispatchEvent(t,e,r,n,a.label,u,i,l))})},o.prototype.bindEvents=function(e,t,r,n,a,o){},new o}]),z.module("ui-leaflet").factory("leafletMapEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpers","leafletIterators",function(e,t,i,r,n,l){function s(r,n,a,o){return o&&(o+="."),function(e){var t="leafletDirectiveMap."+o+n;i.debug(t),u(r,t,a,e,e.target,r)}}var c=r.isDefined,u=n.fire;return{getAvailableMapEvents:function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomanim","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},genDispatchMapEvent:s,notifyCenterChangedToBounds:function(e){e.$broadcast("boundsChanged")},notifyCenterUrlHashChanged:function(e,t,r,n){if(c(r.urlHashCenter)){var a=t.getCenter(),o=a.lat.toFixed(4)+":"+a.lng.toFixed(4)+":"+t.getZoom();c(n.c)&&n.c===o||e.$emit("centerUrlHash",o)}},addEvents:function(r,n,e,a,o,i){l.each(e,function(e){var t={};t[a]=e,n=n||(r._container.id||""),r.on(e,s(o,e,i,n),t)})}}}]),z.module("ui-leaflet").factory("leafletMarkerEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpersFactory","leafletLabelEvents",function(c,e,t,r,n,a){function o(){d.call(this,"leafletDirectiveMarker","markers")}var u=r.safeApply,l=r.isDefined,s=r,f=a,d=n;return(o.prototype=new d).genDispatchEvent=function(e,t,r,n,a,o,i,l){var s=d.prototype.genDispatchEvent.call(this,e,t,r,n,a,o,i,l);return function(e){"click"===t?u(n,function(){c.$broadcast("leafletDirectiveMarkersClick",o)}):"dragend"===t&&(u(n,function(){i.lat=a.getLatLng().lat,i.lng=a.getLatLng().lng}),i.message&&!0===i.focus&&a.openPopup()),s(e)}},o.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose","touchend","touchstart","touchmove","touchcancel","touchleave"]},o.prototype.bindEvents=function(e,t,r,n,a,o){var i=d.prototype.bindEvents.call(this,e,t,r,n,a,o);s.LabelPlugin.isLoaded()&&l(t.label)&&f.genEvents(e,r,i,a,t,n,o)},new o}]);var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};z.module("ui-leaflet").factory("leafletPathEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletLabelEvents","leafletEventsHelpers",function(e,t,r,n,a,o){function d(r,n,a,o,i,l,s,c){return r=(r=r||"")&&"."+r,function(e){var t="leafletDirectivePath"+r+"."+n;h.debug(t),u(o,t,a,e,e.target||i,s,l,c)}}var p=n.isDefined,g=n.isObject,y=n,v=n.errorHeader,m=a,u=o.fire,h=r,L=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailablePathEvents:L,bindPathEvents:function(e,t,r,n,a){var o,i,l=[],s="broadcast";if(p(a.eventBroadcast))if(g(a.eventBroadcast))if(p(a.eventBroadcast.path))if(g(a.eventBroadcast.paths))h.warn(v+"event-broadcast.path must be an object check your model.");else{void 0!==a.eventBroadcast.path.logic&&null!==a.eventBroadcast.path.logic&&("emit"!==a.eventBroadcast.path.logic&&"broadcast"!==a.eventBroadcast.path.logic?h.warn(v+"Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===a.eventBroadcast.path.logic&&(s="emit"));var c=!1,u=!1;if(void 0!==a.eventBroadcast.path.enable&&null!==a.eventBroadcast.path.enable&&"object"===b(a.eventBroadcast.path.enable)&&(c=!0),void 0!==a.eventBroadcast.path.disable&&null!==a.eventBroadcast.path.disable&&"object"===b(a.eventBroadcast.path.disable)&&(u=!0),c&&u)h.warn(v+"can not enable and disable events at the same time");else if(c||u)if(c)for(o=0;o<a.eventBroadcast.path.enable.length;o++)i=a.eventBroadcast.path.enable[o],-1!==l.indexOf(i)?h.warn(v+"This event "+i+" is already enabled"):-1===L().indexOf(i)?h.warn(v+"This event "+i+" does not exist"):l.push(i);else for(l=L(),o=0;o<a.eventBroadcast.path.disable.length;o++){i=a.eventBroadcast.path.disable[o];var f=l.indexOf(i);-1===f?h.warn(v+"This event "+i+" does not exist or has been already disabled"):l.splice(f,1)}else h.warn(v+"must enable or disable events")}else l=L();else h.error(v+"event-broadcast must be an object check your model.");else l=L();for(o=0;o<l.length;o++)i=l[o],t.on(i,d(e,i,s,a,l,r));y.LabelPlugin.isLoaded()&&p(t.label)&&m.genEvents(e,r,s,a,t,n)}}}])}(angular);