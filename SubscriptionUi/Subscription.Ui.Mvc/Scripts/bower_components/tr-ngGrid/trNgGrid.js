"use strict";var TrNgGrid;!function(h){var e;(e=h.SelectionMode||(h.SelectionMode={}))[e.None=0]="None",e[e.SingleRow=1]="SingleRow",e[e.MultiRow=2]="MultiRow",e[e.MultiRowWithKeyModifiers=3]="MultiRowWithKeyModifiers";var g=h.SelectionMode;h.defaultColumnOptionsTemplate={cellWidth:null,cellHeight:null,displayAlign:null,displayFormat:null,displayName:null,filter:null,enableFiltering:null,enableSorting:null},h.defaultColumnOptions={},h.translations={};var s=h.debugMode=!1,t="trNgGrid";h.sortFilter=t+"SortFilter",h.dataPagingFilter=t+"DataPagingFilter",h.translateFilter=t+"TranslateFilter",h.translationDateFormat=t+"DateFormat",h.dataFormattingFilter=t+"DataFormatFilter";var v="tr-ng-grid-body",a="field-name",i="trNgGridFooterCellTemplate";h.cellFooterTemplateId=i+".html";var r="trNgGridGlobalFilter";h.globalFilterDirectiveAttribute="tr-ng-grid-global-filter",h.footerGlobalFilterTemplateId=r+".html";var n="trNgGridPager";h.pagerDirectiveAttribute="tr-ng-grid-pager",h.footerPagerTemplateId=n+".html";var d="trNgGridHeaderCell",l="trNgGridHeaderCellTemplate";h.cellHeaderTemplateId=l+".html";var o="trNgGridBodyCell",c="trNgGridBodyCellTemplate";h.cellBodyTemplateId=c+".html";var u="trNgGridColumnSort";h.columnSortDirectiveAttribute="tr-ng-grid-column-sort",h.columnSortTemplateId=u+".html";var p="trNgGridColumnFilter";h.columnFilterDirectiveAttribute="tr-ng-grid-column-filter",h.columnFilterTemplateId=p+".html";function m(e,t){t=t.toUpperCase();for(var i=e.children(),r=0;r<i.length;r++){var n=i[r];if(n.tagName==t)return angular.element(n)}return null}function I(e,t,i,r){var n=[],l=t.slice(0);return angular.forEach(e,function(e){for(var t=null,i=0;!t&&i<l.length;i++)(t=l[i]).fieldName===e.fieldName?l.splice(i,1):t=null;t?n.push(t):n.push(e)}),(i||r)&&angular.forEach(l,function(e){(i&&e.fieldName||r&&!e.fieldName)&&n.push(e)}),n}function f(e,t,i,r){if(i){var n=e.children(),l=angular.element(n[0]);if(1!==n.length||!l.attr(r)){e.empty();var a=angular.element("<div></div>").attr(r,"");e.append(a),angular.forEach(n,function(e){a.append(angular.element(e))})}}else e.empty(),e.append(angular.element("<div></div>").attr(r,""))}var O=function(e,t){this.parent=e,this.cellElement=t,this.fieldName=t.attr(a)||t.attr("data-field-name");var i=t.children();this.isStandardColumn=0===i.length},y=(C.prototype.configureSection=function(e,t){var r=this,i=this.getSectionElement(e,!0);i.empty(),i.removeAttr("ng-non-bindable");var n=I(t,this.cells,!1,!1),l=this.getTemplatedRowElement(i,!0);return angular.forEach(n,function(e,t){var i;i=e.parent===r&&e.cellElement?e.cellElement.clone(!0):angular.element("<table><"+r.cellTagName+"></"+r.cellTagName+"></table>").find(r.cellTagName),r.cellDirectiveAttribute&&i.attr(r.cellDirectiveAttribute,t),e.isStandardColumn||i.attr("is-customized","true"),e.fieldName&&i.attr(a,e.fieldName),i.attr("ng-style","{'width':columnOptions.cellWidth,'height':columnOptions.cellHeight}"),l.append(i)}),i},C.prototype.extractPartialColumnDefinitions=function(){return this.cells},C.prototype.discoverTemplates=function(e){var r=this;this.cells=[],this.cellRow=null;var t=this.getTemplatedRowElement(this.getSectionElement(e,!1),!1);t&&(this.cellRow=angular.element(t.clone()),this.cellRow.empty(),angular.forEach(t.children(),function(e,t){if((e=angular.element(e))[0].tagName===r.cellTagName.toUpperCase()){var i=e.clone();r.cells.push(new O(r,i))}}))},C.prototype.getSectionElement=function(e,t){var i=null;return e&&(i=m(e,this.sectionTagName)),!i&&t&&(i=angular.element("<table><"+this.sectionTagName+"></"+this.sectionTagName+"></table>").find(this.sectionTagName),e&&e.append(i)),i&&t&&this.sectionDirectiveAttribute&&i.attr(this.sectionDirectiveAttribute,""),i},C.prototype.getTemplatedRowElement=function(e,t){var i=null;return e&&(i=m(e,"tr")),!i&&t&&(i=this.cellRow?angular.element(this.cellRow.clone()):angular.element("<table><tr></tr></table>").find("tr"),e&&e.append(i)),i&&t&&this.rowDirectiveAttribute&&i.attr(this.rowDirectiveAttribute,""),i},C);function C(e,t,i,r,n){this.sectionTagName=e,this.sectionDirectiveAttribute=t,this.rowDirectiveAttribute=i,this.cellTagName=r,this.cellDirectiveAttribute=n,this.cellTagName=this.cellTagName.toUpperCase(),this.cells=null}var F=(D.prototype.setupGrid=function(e,t,i){return this.gridOptions=t,this.isInServerSideMode=i,e.gridOptions=t,e.TrNgGrid=h,t.gridColumnDefs=[],void 0===t.locale&&(t.locale="en"),void 0===t.selectionMode&&(t.selectionMode=g[g.MultiRow]),void 0===t.filterByFields&&(t.filterByFields={}),void 0===t.enableFiltering&&(t.enableFiltering=!0),void 0===t.enableSorting&&(t.enableSorting=!0),void 0===t.onDataRequiredDelay&&(t.onDataRequiredDelay=1e3),void 0===t.selectedItems&&(t.selectedItems=[]),void 0===t.currentPage&&(t.currentPage=0),this.setupServerSideModeTriggers(e),this.setupDataFilteringTriggers(e),this.setupDataFormattingTriggers(e),this.setupDataSelectionTriggers(e),e},D.prototype.setupDataFilteringTriggers=function(e){var i=this,t=!1;if(this.scheduleDataFiltering=function(){t||(e.$evalAsync(function(){t=!1,i.computeFilteredItems(e)}),t=!0)},!this.isInServerSideMode){var r=!0;e.$watchCollection("[gridOptions.filterBy,gridOptions.filterByFields,gridOptions.orderBy,gridOptions.orderByReverse,gridOptions.pageItems]",function(e,t){r?r=!1:(i.gridOptions.currentPage=0,i.scheduleDataFiltering())}),e.$watch("gridOptions.currentPage",function(e,t){e!==t&&i.scheduleDataFiltering()})}},D.prototype.setupDataFormattingTriggers=function(e){var t=this,i=!1;this.scheduleDataFormatting=function(){i||(e.$evalAsync(function(){i=!1,t.computeFormattedItems(e)}),i=!0)};var r="[gridOptions.items,gridOptions.gridColumnDefs.length";angular.forEach(e.gridOptions.gridColumnDefs,function(e){if(e.displayFormat&&"."!=e.displayFormat[0]){var t=e.displayFormat.split("|");angular.forEach(t,function(e){var t=e.split(":");1<t.length&&angular.forEach(t.slice(1),function(e){(e=e.trim())&&"gridItem"!==e&&"gridDisplayItem"!==e&&(r+=","+e)})})}}),r+="]",h.debugMode&&this.log("re-formatting is set to watch for changes in "+r),e.$watch(r,function(){return t.scheduleDataFormatting()},!0)},D.prototype.setupServerSideModeTriggers=function(t){var i=this;if(this.isInServerSideMode){var r=null,n=!1,l=!1,a=!1,s=function(){r&&(i.$timeout.cancel(r),r=null)},o=function(){function e(){t.$applyAsync(function(){n=!1;try{h.debugMode&&i.log("Requesting data - server side mode"),i.gridOptions.onDataRequired(i.gridOptions)}catch(e){throw h.debugMode&&i.log("Data retrieval failed "+e),e}})}h.debugMode&&i.log("Preparing to request data - server side mode"),s(),a?t.$evalAsync(function(){h.debugMode&&i.log("Resetting the page index - server side mode"),t.gridOptions.currentPage=0,a=!1,e()}):e()};this.scheduleServerSideModeDataRetrieval=function(){n||(s(),r=i.$timeout(function(){n=!(r=null),o()},i.gridOptions.onDataRequiredDelay,!0),l&&i.speedUpServerSideModeDataRetrieval())},this.speedUpServerSideModeDataRetrieval=function(e){e&&13!=e.keyCode||(r?(l=!1,s(),n=!0,o()):l=!0)},t.$watch("gridOptions.currentPage",function(e,t){e!==t&&(h.debugMode&&i.log("Changes detected in the current page index in server-side mode. Scheduling data retrieval..."),i.scheduleServerSideModeDataRetrieval())});var d=!0;t.$watchCollection("[gridOptions.filterBy, gridOptions.filterByFields, gridOptions.orderBy, gridOptions.orderByReverse, gridOptions.pageItems]",function(e,t){d?d=!1:(0!==i.gridOptions.currentPage&&(h.debugMode&&i.log("Changes detected in parameters in server-side mode. Requesting a page index reset..."),a=!0),h.debugMode&&i.log("Changes detected in parameters in server-side mode. Scheduling data retrieval..."),i.scheduleServerSideModeDataRetrieval())}),this.scheduleServerSideModeDataRetrieval(),this.speedUpServerSideModeDataRetrieval()}else this.speedUpServerSideModeDataRetrieval=function(e){};t.speedUpAsyncDataRetrieval=function(e){return i.speedUpServerSideModeDataRetrieval(e)}},D.prototype.setupDataSelectionTriggers=function(e){var i=this;e.$watch("gridOptions.selectionMode",function(e,t){if(e!==t)switch(e){case g[g.None]:i.gridOptions.selectedItems.splice(0);break;case g[g.SingleRow]:1<i.gridOptions.selectedItems.length&&i.gridOptions.selectedItems.splice(1)}})},D.prototype.setColumnOptions=function(e,t){var i=this.gridOptions.gridColumnDefs[e];if(!i)throw"Invalid grid column options found for column index "+e+". Please report this error.";t=angular.extend(t,i),this.gridOptions.gridColumnDefs[e]=t},D.prototype.toggleSorting=function(e){this.gridOptions.orderBy!=e?this.gridOptions.orderBy=e:this.gridOptions.orderByReverse=!this.gridOptions.orderByReverse,this.speedUpServerSideModeDataRetrieval()},D.prototype.toggleItemSelection=function(e,t,i){if(this.gridOptions.selectionMode!==g[g.None])switch(this.gridOptions.selectionMode){case g[g.MultiRowWithKeyModifiers]:if(i.ctrlKey||i.shiftKey||i.metaKey){if(i.ctrlKey||i.metaKey)0<=(d=this.gridOptions.selectedItems.indexOf(t))?this.gridOptions.selectedItems.splice(d,1):this.gridOptions.selectedItems.push(t);else if(i.shiftKey){document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges();var r,n,l=this.gridOptions.selectedItems[this.gridOptions.selectedItems.length-1];for(r=0;r<e.length&&e[r].$$_gridItem!==l;r++);for(r>=e.length&&(r=0),n=0;n<e.length&&e[n].$$_gridItem!==t;n++);if(n>=e.length)throw"Invalid selection on a key modifier selection mode";if(n<r){var a=r;r=n,n=a}for(var s=r;s<=n;s++){var o=e[s].$$_gridItem;this.gridOptions.selectedItems.indexOf(o)<0&&this.gridOptions.selectedItems.push(o)}}}else{var d=this.gridOptions.selectedItems.indexOf(t);this.gridOptions.selectedItems.splice(0),d<0&&this.gridOptions.selectedItems.push(t)}break;case g[g.SingleRow]:d=this.gridOptions.selectedItems.indexOf(t),this.gridOptions.selectedItems.splice(0),d<0&&this.gridOptions.selectedItems.push(t);break;case g[g.MultiRow]:0<=(d=this.gridOptions.selectedItems.indexOf(t))?this.gridOptions.selectedItems.splice(d,1):this.gridOptions.selectedItems.push(t)}},D.prototype.discoverTemplates=function(e){this.templatedHeader=new y("thead",null,null,"th","tr-ng-grid-header-cell"),this.templatedBody=new y("tbody",v,null,"td","tr-ng-grid-body-cell"),this.templatedFooter=new y("tfoot",null,null,"td","tr-ng-grid-footer-cell"),this.templatedHeader.discoverTemplates(e),this.templatedFooter.discoverTemplates(e),this.templatedBody.discoverTemplates(e)},D.prototype.getSafeFieldName=function(e){return e.replace(/[^a-zA-Z0-9]/g,"_")},D.prototype.configureTableStructure=function(i,r,e){var n=this;try{if(r.empty(),e){var t=e;this.$timeout(function(){t.$destroy()}),e=null}var l=i.$new();this.columnDefsItemsWatcherDeregistration&&(this.columnDefsItemsWatcherDeregistration(),this.columnDefsItemsWatcherDeregistration=null),this.columnDefsFieldsWatcherDeregistration&&(this.columnDefsFieldsWatcherDeregistration(),this.columnDefsFieldsWatcherDeregistration=null),this.columnDefsFieldsWatcherDeregistration=l.$watch("gridOptions.fields",function(e,t){angular.equals(e,t)||n.configureTableStructure(i,r,l)},!0);var a=this.templatedHeader.extractPartialColumnDefinitions(),s=this.templatedBody.extractPartialColumnDefinitions(),o=this.templatedFooter.extractPartialColumnDefinitions(),d=[];if(this.gridOptions.fields)angular.forEach(this.gridOptions.fields,function(e){e&&d.push({isStandardColumn:!0,fieldName:e})}),d=I(d,a,!1,!0),d=I(d,s,!1,!0);else if(0<a.length)d=I(a,s,!0,!0);else{if(!this.gridOptions.items||0==this.gridOptions.items.length)return void(this.columnDefsItemsWatcherDeregistration=l.$watch("gridOptions.items.length",function(e,t){e&&n.configureTableStructure(i,r,l)}));for(var g in this.gridOptions.items[0])d.push({isStandardColumn:!0,fieldName:g});d=I(d,s,!0,!0)}0==o.length&&o.push({isStandardColumn:!0}),angular.forEach(d,function(e){if(e.fieldName){var t,i=e.fieldName;e.displayFieldName=n.getSafeFieldName(i),t="["===i[0]?i:i.replace(/^([^\.]+)/g,'["$1"]'),e.fieldExtractionExpression=t}}),this.gridOptions.gridColumnDefs=d;var c=this.templatedHeader.configureSection(r,d),u=this.templatedFooter.configureSection(r,o),p=this.templatedBody.configureSection(r,d),m=this.templatedBody.getTemplatedRowElement(p);this.templatedHeader.getTemplatedRowElement(c),p.attr(v,""),m.attr("ng-click","toggleItemSelection(gridItem, $event)"),m.attr("ng-repeat","gridDisplayItem in filteredItems"),m.attr("ng-init","gridItem=gridDisplayItem.$$_gridItem;"+m.attr("ng-init"));var f=m.attr("ng-class");f=(f||"").replace(/^(\s*\{?)(.*?)(\}?\s*)$/,"{'"+h.rowSelectedCssClass+"':gridOptions.selectedItems.indexOf(gridItem) >= 0, $2}"),m.attr("ng-class",f),this.$compile(c)(l),this.$compile(u)(l),this.$compile(p)(l)}catch(e){throw h.debugMode&&this.log("Fixing table structure failed with error "+e),e}},D.prototype.computeFormattedItems=function(e){var t=e.gridOptions.items||[];h.debugMode&&this.log("formatting items of length "+t.length);try{for(var i=e.formattedItems=e.formattedItems||[],r=e.gridOptions.gridColumnDefs,n=0;n<t.length;n++){for(var l,a=t[n],s={gridItem:a};i.length>t.length&&(l=i[n]).$$_gridItem!==a;)i.splice(n,1);n<i.length?(l=i[n]).$$_gridItem!==a&&(l={$$_gridItem:a},i[n]=l):(l={$$_gridItem:a},i.push(l));for(var o=0;o<r.length;o++)try{var d=r[o];if(d.displayFieldName&&d.fieldExtractionExpression){var g=d.displayFormat;g&&"."!==g[0]&&"|"!==g[0]&&"["!==g[0]&&(g=" | "+g),l[d.displayFieldName]=e.$eval("gridItem"+d.fieldExtractionExpression+(g||""),s)}}catch(e){h.debugMode&&this.log("Field evaluation failed for <unknown> with error "+e)}}i.length>t.length&&i.splice(t.length,i.length-t.length),this.scheduleDataFiltering()}catch(e){throw h.debugMode&&this.log("Failed to format items "+e),e}},D.prototype.extractDataItems=function(e){var t;if(e){t=new Array(e.length);for(var i=0;i<e.length;i++)t[i]=e[i].$$_gridItem}else t=[];return t},D.prototype.computeFilteredItems=function(e){try{if(this.isInServerSideMode)e.filteredItems=e.formattedItems;else{if(e.filterByDisplayFields={},e.gridOptions.filterByFields)for(var t in e.gridOptions.filterByFields)e.filterByDisplayFields[this.getSafeFieldName(t)]=e.gridOptions.filterByFields[t];h.debugMode&&this.log("filtering items of length "+(e.formattedItems?e.formattedItems.length:0)),e.filteredItems=e.$eval("formattedItems | filter:gridOptions.filterBy | filter:filterByDisplayFields | "+h.sortFilter+":gridOptions"),e.gridOptions.filteredItems&&(e.gridOptions.filteredItems=this.extractDataItems(e.filteredItems)),e.filteredItems=e.$eval("filteredItems | "+h.dataPagingFilter+":gridOptions")}e.gridOptions.filteredItemsPage&&(e.gridOptions.filteredItemsPage=this.extractDataItems(e.filteredItems))}catch(e){throw h.debugMode&&this.log("Failed to filter items "+e),e}},D.prototype.linkAttrs=function(e,i){function r(e,t){if(void 0!==t){switch(t){case"true":t=!0;break;case"false":t=!1}i[e]=t}}for(var t in i)r(t,e[t]),function(t){e.$observe(t,function(e){return r(t,e)})}(t)},D.prototype.log=function(e){console.log(t+"("+(new Date).getTime()+"): "+e)},D);function D(e,t,i,r,n){var l,a;this.$compile=e,this.$parse=t,this.$timeout=i,s||(S(l=r,a=n,h.cellHeaderTemplateId,'<div class="'+h.headerCellCssClass+'" ng-switch="isCustomized">  <div ng-switch-when="true">    <div ng-transclude=""></div>  </div>  <div ng-switch-default>    <div class="'+h.columnTitleCssClass+'">      {{columnTitle |'+h.translateFilter+":gridOptions.locale}}       <div "+h.columnSortDirectiveAttribute+'=""></div>    </div>    <div '+h.columnFilterDirectiveAttribute+'=""></div>  </div></div>'),S(l,a,h.cellBodyTemplateId,'<div ng-attr-class="'+h.bodyCellCssClass+' text-{{columnOptions.displayAlign}}" ng-switch="isCustomized">  <div ng-switch-when="true">    <div ng-transclude=""></div>  </div>  <div ng-switch-default>{{gridDisplayItem[columnOptions.displayFieldName]}}</div></div>'),S(l,a,h.columnFilterTemplateId,'<div ng-show="(gridOptions.enableFiltering&&columnOptions.enableFiltering!==false)||columnOptions.enableFiltering" class="'+h.columnFilterCssClass+'"> <div class="'+h.columnFilterInputWrapperCssClass+'">   <input class="form-control input-sm" type="text" ng-model="columnOptions.filter" ng-keypress="speedUpAsyncDataRetrieval($event)"></input> </div></div>'),S(l,a,h.columnSortTemplateId,"<div ng-attr-title=\"{{'Sort'|"+h.translateFilter+':gridOptions.locale}}" ng-show="(gridOptions.enableSorting&&columnOptions.enableSorting!==false)||columnOptions.enableSorting" ng-click="toggleSorting(columnOptions.fieldName)" class="'+h.columnSortCssClass+'" >   <div ng-class="{\''+h.columnSortActiveCssClass+"':gridOptions.orderBy==columnOptions.fieldName,'"+h.columnSortInactiveCssClass+"':gridOptions.orderBy!=columnOptions.fieldName,'"+h.columnSortNormalOrderCssClass+"':gridOptions.orderBy==columnOptions.fieldName&&!gridOptions.orderByReverse,'"+h.columnSortReverseOrderCssClass+"':gridOptions.orderBy==columnOptions.fieldName&&gridOptions.orderByReverse}\" >  </div></div>"),S(l,a,h.cellFooterTemplateId,'<div class="'+h.footerCssClass+'" ng-switch="isCustomized">  <div ng-switch-when="true">    <div ng-transclude=""></div>  </div>  <div ng-switch-default>    <span '+h.globalFilterDirectiveAttribute+'=""></span>    <span '+h.pagerDirectiveAttribute+'=""></span>  </div></div>'),S(l,a,h.footerGlobalFilterTemplateId,'<span ng-show="gridOptions.enableFiltering" class="pull-left form-group">  <input class="form-control" type="text" ng-model="gridOptions.filterBy" ng-keypress="speedUpAsyncDataRetrieval($event)" ng-attr-placeholder="{{\'Search\'|'+h.translateFilter+':gridOptions.locale}}"></input></span>'),S(l,a,h.footerPagerTemplateId,'<span class="pull-right form-group"> <ul class="pagination">   <li ng-class="{disabled:!pageCanGoBack}" ng-if="extendedControlsActive">     <a href="" ng-click="pageCanGoBack&&navigateToPage(0)" ng-attr-title="{{\'First Page\'|'+h.translateFilter+':gridOptions.locale}}">         <span>&laquo;</span>     </a>   </li>   <li ng-class="{disabled:!pageCanGoBack}" ng-if="extendedControlsActive">     <a href="" ng-click="pageCanGoBack&&navigateToPage(gridOptions.currentPage - 1)" ng-attr-title="{{\'Previous Page\'|'+h.translateFilter+':gridOptions.locale}}">         <span>&lsaquo;</span>     </a>   </li>   <li ng-if="pageSelectionActive" ng-repeat="pageIndex in pageIndexes track by $index" ng-class="{disabled:pageIndex===null, active:pageIndex===gridOptions.currentPage}">      <span ng-if="pageIndex===null">...</span>      <a href="" ng-click="navigateToPage(pageIndex)" ng-if="pageIndex!==null" ng-attr-title="{{\'Page\'|'+h.translateFilter+':gridOptions.locale}}">{{pageIndex+1}}</a>   </li>   <li ng-class="{disabled:!pageCanGoForward}" ng-if="extendedControlsActive">     <a href="" ng-click="pageCanGoForward&&navigateToPage(gridOptions.currentPage + 1)" ng-attr-title="{{\'Next Page\'|'+h.translateFilter+':gridOptions.locale}}">         <span>&rsaquo;</span>     </a>   </li>   <li ng-class="{disabled:!pageCanGoForward}" ng-if="extendedControlsActive">     <a href="" ng-click="pageCanGoForward&&navigateToPage(lastPageIndex)" ng-attr-title="{{\'Last Page\'|'+h.translateFilter+':gridOptions.locale}}">         <span>&raquo;</span>     </a>   </li>   <li class="disabled" style="white-space: nowrap;">     <span ng-hide="totalItemsCount">{{\'No items to display\'|'+h.translateFilter+":gridOptions.locale}}</span>     <span ng-show=\"totalItemsCount\">       {{startItemIndex+1}} - {{endItemIndex+1}} {{'displayed'|"+h.translateFilter+":gridOptions.locale}}       <span>, {{totalItemsCount}} {{'in total'|"+h.translateFilter+":gridOptions.locale}}</span>     </span >    </li> </ul></span>"),s=!0)}function S(e,t,i,r){var n=t.startSymbol(),l=t.endSymbol();e.get(i)||("{{"!==n&&(r=r.replace(/\{\{/g,n+" ")),"}}"!==l&&(r=r.replace(/\}\}/g," "+l)),e.put(i,r))}angular.module("trNgGrid",[]).directive(t,[function(){return{restrict:"A",scope:{items:"=",selectedItems:"=?",filteredItems:"=?",filteredItemsPage:"=?",filterBy:"=?",filterByFields:"=?",orderBy:"=?",orderByReverse:"=?",pageItems:"=?",currentPage:"=?",totalItems:"=?",enableFiltering:"=?",enableSorting:"=?",selectionMode:"@",locale:"@",onDataRequired:"&",onDataRequiredDelay:"=?",fields:"=?"},controller:["$compile","$parse","$timeout","$templateCache","$interpolate",F],compile:function(e,t){return angular.forEach(e.children(),function(e){(e=angular.element(e)).attr("ng-non-bindable","")}),{pre:function(e,t,i,r,n){r.discoverTemplates(t)},post:function(e,t,i,r,n){t.addClass(h.tableCssClass);var l=e.$parent.$new();r.setupGrid(l,e,!!i.onDataRequired),r.configureTableStructure(l,t),e.$on("$destroy",function(){l.$destroy(),h.debugMode&&r.log("grid scope destroyed")})}}}}}]).directive(d,[function(){return{restrict:"A",require:"^"+t,scope:!0,compile:function(e,t){var o="true"==t.isCustomized;return f(e,0,o,"tr-ng-grid-header-cell-template"),{pre:function(i,e,t,r,n){var l=parseInt(t[d]),a=angular.extend(i.gridOptions.gridColumnDefs[l],h.defaultColumnOptionsTemplate,h.defaultColumnOptions);r.linkAttrs(t,a),i.columnOptions=a,i.isCustomized=o,i.toggleSorting=function(e){r.toggleSorting(e)},i.$watch("columnOptions.displayName",function(){!function(e){if(e.columnOptions.displayName)e.columnTitle=e.columnOptions.displayName;else if(e.columnOptions.fieldName){var t=e.columnOptions.fieldName.replace(/^([^\a-zA-Z]*)([\a-zA-Z0-9]*)(.*)/g,"$2").split(/(?=[A-Z])/);t.length&&t[0].length&&(t[0]=t[0][0].toLocaleUpperCase()+t[0].substr(1)),e.columnTitle=t.join(" ")}else e.columnTitle=""}(i)});var s=!1;i.$watch("gridOptions.filterByFields['"+a.fieldName+"']",function(e,t){a.filter!==e&&(a.filter=e),s||(i.$watch("columnOptions.filter",function(e,t){i.gridOptions.filterByFields[a.fieldName]!==e&&(e?i.gridOptions.filterByFields[a.fieldName]=e:delete i.gridOptions.filterByFields[a.fieldName],i.gridOptions.filterByFields=angular.extend({},i.gridOptions.filterByFields))}),s=!0)})}}}}}]).directive(l,[function(){return{restrict:"A",templateUrl:h.cellHeaderTemplateId,transclude:!0,replace:!0}}]).directive("trNgGridBody",[function(){return{restrict:"A",require:"^"+t,scope:!0,compile:function(e,t){return{pre:function(i,e,t,r){i.toggleItemSelection=function(e,t){r.toggleItemSelection(i.filteredItems,e,t)}}}}}}]).directive(o,[function(){return{restrict:"A",require:"^"+t,scope:!0,compile:function(e,t){var l="true"==t.isCustomized;return f(e,0,l,"tr-ng-grid-body-cell-template"),{pre:function(e,t,i,r,n){e.columnOptions=e.gridOptions.gridColumnDefs[parseInt(i[o])],e.gridItem=e.gridDisplayItem.$$_gridItem,e.isCustomized=l}}}}}]).directive(c,[function(){return{restrict:"A",templateUrl:h.cellBodyTemplateId,transclude:!0,replace:!0}}]).directive("trNgGridFooterCell",[function(){return{restrict:"A",require:"^"+t,scope:!0,compile:function(e,t){var l="true"==t.isCustomized;return f(e,0,l,"tr-ng-grid-footer-cell-template"),{pre:function(e,t,i,r,n){e.isCustomized=l,t.attr("colspan",e.gridOptions.gridColumnDefs.length)}}}}}]).directive(i,[function(){return{restrict:"A",templateUrl:h.cellFooterTemplateId,transclude:!0,replace:!0}}]).directive(u,[function(){return{restrict:"A",replace:!0,templateUrl:h.columnSortTemplateId}}]).directive(p,[function(){return{restrict:"A",replace:!0,templateUrl:h.columnFilterTemplateId}}]).directive(r,[function(){return{restrict:"A",scope:!1,templateUrl:h.footerGlobalFilterTemplateId}}]).directive(n,[function(){function n(i,e){if(i.totalItemsCount=void 0!==i.gridOptions.totalItems&&null!=i.gridOptions.totalItems?i.gridOptions.totalItems:i.gridOptions.items?i.gridOptions.items.length:0,i.isPaged=!!i.gridOptions.pageItems&&i.gridOptions.pageItems<i.totalItemsCount,i.extendedControlsActive=!1,i.lastPageIndex=i.totalItemsCount&&i.isPaged?Math.floor(i.totalItemsCount/i.gridOptions.pageItems)+(i.totalItemsCount%i.gridOptions.pageItems?0:-1):0,i.gridOptions.currentPage>i.lastPageIndex&&(h.debugMode&&e.log("The current page index falls outside of the range of items. Either the attached parameter has a wrong value or the total items count is not properly set in server side mode."),i.gridOptions.currentPage=i.lastPageIndex),i.startItemIndex=i.isPaged?i.gridOptions.pageItems*i.gridOptions.currentPage:0,i.endItemIndex=i.isPaged?i.startItemIndex+i.gridOptions.pageItems-1:i.totalItemsCount-1,i.endItemIndex>=i.totalItemsCount&&(i.endItemIndex=i.totalItemsCount-1),i.endItemIndex<i.startItemIndex&&(i.endItemIndex=i.startItemIndex),i.pageCanGoBack=i.isPaged&&0<i.gridOptions.currentPage,i.pageCanGoForward=i.isPaged&&i.gridOptions.currentPage<i.lastPageIndex,i.pageIndexes=i.pageIndexes||[],i.pageIndexes.splice(0),i.isPaged)if(i.lastPageIndex+1>h.defaultPagerMinifiedPageCountThreshold){i.extendedControlsActive=!0;var t=Math.floor(h.defaultPagerMinifiedPageCountThreshold/2),r=i.gridOptions.currentPage-t,n=i.gridOptions.currentPage+t;r<0?(n+=-r,r=0):n>i.lastPageIndex&&(r-=n-i.lastPageIndex,n=i.lastPageIndex),0<r&&(i.pageIndexes.push(null),r++);var l=!1;n<i.lastPageIndex&&(l=!0,n--);for(var a=r;a<=n;a++)i.pageIndexes.push(a);l&&i.pageIndexes.push(null)}else{i.extendedControlsActive=!1;for(a=0;a<=i.lastPageIndex;a++)i.pageIndexes.push(a)}i.pageSelectionActive=1<i.pageIndexes.length,i.navigateToPage=function(e){i.gridOptions.currentPage=e,i.speedUpAsyncDataRetrieval()},i.switchPageSelection=function(e,t){i.pageSelectionActive=t,e&&(e.preventDefault(),e.stopPropagation())}}return{restrict:"A",scope:!0,require:"^"+t,templateUrl:h.footerPagerTemplateId,replace:!0,compile:function(e,t){return{pre:function(e,t,i,r){n(e,r)},post:function(i,e,t,r){i.$watchCollection("[gridOptions.currentPage, gridOptions.items.length, gridOptions.totalItems, gridOptions.pageItems]",function(e,t){n(i,r)})}}}}}]).filter(h.sortFilter,["$filter","$parse",function(n,l){return function(e,t){if(!t.orderBy||!t.gridColumnDefs)return e;for(var i=null,r=0;r<t.gridColumnDefs.length&&(i=t.gridColumnDefs[r]).fieldName!==t.orderBy;i=null,r++);return i?n("orderBy")(e,function(e){var t=void 0;if(i.fieldExtractionExpression)try{t=l("item.$$_gridItem"+i.fieldExtractionExpression)({item:e})}catch(e){}if(void 0===t)try{t=l('item["'+i.displayFieldName+'"]')({item:e})}catch(e){}return t},t.orderByReverse):e}}]).filter(h.dataPagingFilter,function(){return function(e,t){if(e&&(t.totalItems=e.length),!t.pageItems||!e||0==e.length)return e;t.currentPage||(t.currentPage=0);var i=t.currentPage*t.pageItems;i>=e.length&&(i=t.currentPage=0);var r=t.currentPage*t.pageItems+t.pageItems;return e.slice(i,r)}}).filter(h.translateFilter,["$filter","$injector",function(o,d){return function(e,t){var i=null;if(!t)throw"Language identifier is not set";if(e instanceof Date){var r=o(h.translateFilter)(h.translationDateFormat,t);return r&&r!==h.translationDateFormat?i=o("date")(e,r):e}for(var n=t.split(/[-_]/),l=n.length;0<l&&!i;l--){var a=n.slice(0,l).join("-"),s=h.translations[a];s&&(i=s[e])}if(!i&&d.has("translateFilter"))try{i=o("translate")(e)}catch(e){}return i=i||e}}]).run(function(){h.tableCssClass="tr-ng-grid table table-hover",h.cellCssClass="tr-ng-cell",h.headerCellCssClass="tr-ng-column-header "+h.cellCssClass,h.bodyCellCssClass=h.cellCssClass,h.columnTitleCssClass="tr-ng-title",h.columnSortCssClass="tr-ng-sort",h.columnFilterCssClass="tr-ng-column-filter",h.columnFilterInputWrapperCssClass="",h.columnSortActiveCssClass="tr-sort-icon tr-ng-sort-active text-info",h.columnSortInactiveCssClass="tr-sort-icon tr-ng-sort-inactive text-muted  fa fa-sort-down",h.columnSortReverseOrderCssClass="tr-ng-sort-order-reverse  fa fa-sort-down",h.columnSortNormalOrderCssClass="tr-ng-sort-order-normal fa fa-sort-up",h.rowSelectedCssClass="active",h.footerCssClass="tr-ng-grid-footer form-inline"}).run(function(){h.defaultColumnOptions.displayAlign="left",h.defaultPagerMinifiedPageCountThreshold=3})}(TrNgGrid=TrNgGrid||{});